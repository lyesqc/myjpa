package com.yourcompany.struts.action;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.actions.DispatchAction;
import com.yourcompany.struts.form.SortiForm;

import java.io.IOException;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import com.yourcompany.struts.UtilBean.*;
import com.yourcompany.struts.UtilClass.*;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.action.RedirectingActionForward;
import org.apache.struts.actions.DispatchAction;
import java.util.*;
 
 
public class SortieAction extends DispatchAction {
 
 
 
    public ActionForward recherche(ActionMapping mapping, ActionForm form,
      HttpServletRequest request, HttpServletResponse response) throws SQLException,IOException, ServletException  {
     SortiForm sortiForm = (SortiForm) form;// TODO Auto-genera
     
     Connexion connexion=new Connexion();
     Connection con=connexion.createConnection();
     
     Statement st,st1 = null;
     ResultSet rs,rs1 = null;
     Integer R,R1;
     String whs=null,whh=null;
     String prio=null;
     String date=null;
     
     ArrayList list = new ArrayList();
     ArrayList priv =  new ArrayList() ;
     
  
     whh=sortiForm.getMagasin();
     System.out.println(whh);
     
     st1=con.createStatement();
     
     rs1=st1.executeQuery("select whs_id from gss_warehouse where (gss_warehouse.whs_adresse='"+whh+"')");

     if (rs1.next()){
       
        whs=rs1.getString(1).trim();
       System.out.println(whs);
      
       
      }
     request.getSession().setAttribute("warehousenvoi",whs); 
     
     
     st=con.createStatement();
     rs=st.executeQuery("select distinct tr.t_r_trans_type||'-'||tr.t_r_trans_whs||'-'||tr.t_r_trans_no,tr.t_r_trans_type,tr.t_r_trans_whs,tr.t_r_trans_no, gss_destinataire.dest_nom from gss_transaction_range tr, gss_range r, gss_transaction t, gss_warehouse d ,gss_destinataire where tr.t_r_rng_id=r.rng_id and tr.t_r_rng_act_id=r.act_id and tr.t_r_trans_no=t.trans_no and tr.t_r_trans_type=t.trans_type and tr.t_r_trans_whs=t.whs_id and tr.t_r_trans_type='ASO' and r.rng_inactif='A' and t.dest_id=gss_destinataire.dest_id and r.rng_whs='"+whs+"' and r.rng_sortie='O'");
       while (rs.next()){
    Ordre ordre = new Ordre();
    ordre.setOrdre(rs.getString(1).trim());
    ordre.setType(rs.getString(2).trim()); 
    ordre.setCode(rs.getString(4).trim());
    ordre.setWhs(rs.getString(3).trim());
    ordre.setMag(rs.getString(5).trim());
   list.add(ordre);
    
   }
       sortiForm.setListeordre(list);

     
    return mapping.findForward("listsortie");
   }
    
    
    
    public ActionForward ouvrir(ActionMapping mapping, ActionForm form,
      HttpServletRequest request, HttpServletResponse response) throws SQLException,IOException, ServletException  {
     SortiForm sortiForm = (SortiForm) form;
     
       
     Connexion connexion=new Connexion();
     Connection con=connexion.createConnection();
    
     ArrayList priv =  new ArrayList() ;
      String max=null;
      String art,prof,maxi;
      Integer R=0,R1=0;
      String prio=null;
      String date=null;
      Statement st,st1,st3,st4 = null;
      ResultSet rs,rs1,rs3,rs4 = null;
      ArrayList listprof = new ArrayList();
      ArrayList listart = new ArrayList();
      
   ArrayList list = new ArrayList();
   ArrayList list2 = new ArrayList();
   st=con.createStatement();
   st1=con.createStatement();
   st3=con.createStatement();
   st4=con.createStatement();
 

   String whs= (String)request.getSession().getAttribute("warehousenvoi");
   System.out.println(whs);
 
   String code = request.getParameter("code");
   System.out.println("code"+code);
   request.getSession().setAttribute( "code",code);
    
   String type= request.getParameter("type");
   System.out.println("type"+type);
   /*String mag = request.getParameter("mag");
   System.out.println("magasin distinataire"+mag);*/
 
 
   rs=st.executeQuery("select distinct gss_article.art_art_libelle,nvl(gss_article_profil.profil_libelle,'_'),gss_range.rng_start,gss_range.rng_end,decode(gss_range.rng_packaged, 'N','non package', 'O', 'sous ordre', 'C', 'EN COUR', 'P', 'package', '_') PACKAGING,gss_range.rng_statut,case when gss_article.art_type_id in ('S1','S2') then decode(substr(gss_range.rng_start, 4, 1),'0', substr(gss_range.rng_start, 4, 2),'1', substr(gss_range.rng_start, 4, 2),'2', substr(gss_range.rng_start, 4, 2), '0' || substr(gss_range.rng_start, 5, 1)) else '_' end hlr,gss_range.rng_end-gss_range.rng_start+1 as qte,nvl(rng_pq,'_'),nvl(gss_range.rng_swap,'_') from gss_range,gss_article, gss_article_profil,gss_warehouse,gss_article_type,gss_transaction t,gss_transaction_range tr where (gss_article.art_id=gss_range.art_id) and (gss_article_profil.profil_id (+) =gss_range.profil_id ) and (gss_range.rng_whs=gss_warehouse.whs_id) and (gss_article.art_type_id=gss_article_type.art_type_id)and( gss_range.rng_sortie='O')and(gss_range.rng_inactif='A')and tr.t_r_rng_id=gss_range.rng_id and tr.t_r_rng_act_id=gss_range.act_id and tr.t_r_trans_no=t.trans_no and tr.t_r_trans_type=t.trans_type and tr.t_r_trans_whs=t.whs_id and tr.t_r_trans_type='ASO'and tr.t_r_trans_whs ='W00' and tr.t_r_trans_no='"+code+"'");
    rs4=st4.executeQuery("select art_art_libelle from gss_article where  (art_status='A') ");
   rs3=st3.executeQuery("select profil_libelle from gss_article_profil where profil_statut='A'"); 
   while (rs4.next()){
   art = rs4.getString(1).trim();
   listart.add(art);
   System.out.println(art);
   }
   while (rs3.next())
   {
   prof = rs3.getString(1).trim();
   listprof.add(prof);
   System.out.println(prof);
   }
   try{
   rs1=st1.executeQuery("select max(trans_no) from gss_transaction  where (trans_type='SOR') and (whs_id='"+whs+"')");

   while (rs1.next()){
   max = rs1.getString(1).trim();
   }
   int res =Integer.parseInt(max);
   int res1=res+1;
   maxi = Integer.toString(res1);
   System.out.println("le max :"+maxi);
   }

   catch (Exception e){
          maxi = "10000";
          System.out.println("le max=10000"); 
         }
 
   String code_trans = "SOR"+"-"+whs+"-"+maxi;
   System.out.println("le code de reintegration:"+code_trans);
   request.getSession().setAttribute("max", maxi);

   while (rs.next())
    {
     
     System.out.println("["+rs.getString(1)+"],["+rs.getString(2)+"],["+rs.getString(3)+"],["+rs.getString(4)+"],["+rs.getString(5)+"],["+rs.getString(6)+"],["+rs.getString(7)+"],["+rs.getString(8));
    
     
     Rang rang=new Rang();
     
     rang.setArticle(rs.getString(1).trim());
     
     rang.setStart(rs.getString(3).trim());
     rang.setEnd(rs.getString(4).trim());
     rang.setPackag(rs.getString(5).trim());
     rang.setActive(rs.getString(6).trim());
     rang.setHlr(rs.getString(7).trim());
     rang.setQte(rs.getString(8).trim());
     rang.setPq(rs.getString(9).trim());
     if (rs.getString(10).trim().equals("_"))
     {
      rang.setProfil(rs.getString(2).trim()); 
      rang.setProf(rs.getString(2).trim());
     }
     else{
      rang.setProfil(rs.getString(10).trim());
      rang.setProf(rs.getString(10).trim());
     }
     //les paramId
     
     rang.setArt(rs.getString(1).trim());
     
     rang.setSt(rs.getString(3).trim());
     rang.setNd(rs.getString(4).trim());
     rang.setQt(rs.getString(8).trim());
     
     /* date=(rs.getString(9).trim());
     System.out.println("la date :"+date);
      prio=(rs.getString(10).trim());
     System.out.println("la priorite :"+prio);*/
     
      
     
        
     list.add(rang);
    }
    
        Rang3 rang3 =new Rang3();
        
        rang3.setAa("");
        rang3.setEndd("");
        rang3.setProff("");
        rang3.setQtt("");
        rang3.setStt("");
        
        list2.add(rang3);
        
      
        
      
     

        
      
        sortiForm.setResulrang(list);
        sortiForm.setListajouter(list2);
        sortiForm.setNomArticle(listart);
        sortiForm.setListprof(listprof);
        sortiForm.setTrans(code_trans);
        
        
        
     //   request.getSession().setAttribute( "priorite",prio);
       
        sortiForm.setHiddenTest(""); 
        sortiForm.setDoc("");
        sortiForm.setNote("");
        
        System.out.println("c'est bon");
        
        
        
     
     
    return mapping.findForward("sortie");
   }
    
    
    
    

    public ActionForward ajouter(ActionMapping mapping, ActionForm form,
      HttpServletRequest request, HttpServletResponse response) throws SQLException,IOException, ServletException  {
     SortiForm sortiForm = (SortiForm) form;
     
     
     List listt;
     
    // ArrayList mm = new ArrayList();
    // ArrayList mm1 = new ArrayList();
     
     
     
     
     String nn=request.getParameter("art");
     String nn1=request.getParameter("prof");
     String nn2=request.getParameter("st");
     String nn3=request.getParameter("nd");
     String nn4=request.getParameter("qt");
     
     //request.getSession().setAttribute( "art",nn);
     //request.getSession().setAttribute( "prof",nn1);
     
     
     System.out.println(nn);
     System.out.println(nn1);
     System.out.println(nn2);
     System.out.println(nn3);
     System.out.println(nn4);
     
     
     sortiForm.setDebut(nn2);
     sortiForm.setFin(nn3);
     sortiForm.setArticle(nn);
     sortiForm.setProfil(nn1);
     
     
     sortiForm.setHiddenTest("");
     
     
     
    return mapping.findForward("sortie");
   }
    
    public ActionForward ajouter1(ActionMapping mapping, ActionForm form,
      HttpServletRequest request, HttpServletResponse response) throws SQLException,IOException, ServletException  {
     SortiForm sortiForm = (SortiForm) form;

     long R1=0,R2=0,R=0;
     List list=null;
     List listGrand=null;
     ArrayList nouv=new ArrayList();
     Rang3 rang2=new Rang3();
     String  nn1_grand=null;
     Boolean trouver=false, existe= false, existe2=false;
     list=sortiForm.getListajouter();
     listGrand = sortiForm.getResulrang();
     
     String nn=sortiForm.getArticle();
     String nn1=sortiForm.getProfil();
     String nn2=sortiForm.getDebut();
     String nn3=sortiForm.getFin();
     
     System.out.println(nn);
     System.out.println(nn1);
     System.out.println(nn2);
     System.out.println(nn3);
     
     nn1_grand=nn1;
     if (nn1.equals(""))
     {
       nn1_grand="_";
      System.out.println(nn1_grand);
      System.out.println("profil null"); 
     }

   R1=Long.parseLong(nn2);
   R2=Long.parseLong(nn3);
   long  qte=R2-R1+1;
   
   
    String  qute=Long.toString(qte);
    System.out.println(qute);
    
    if (qte<=0){
        sortiForm.setHiddenTest("fin inferieur debut"); 
         System.out.println("le fin est< debut");
         
        sortiForm.setArticle("");
     sortiForm.setProfil("");
     sortiForm.setDebut("");
     sortiForm.setFin("");
        
          return mapping.findForward("sortie");
        }
    
    int size=list.size();
    System.out.println(size);
   
    if (size==0){
         
         System.out.println("la coll est vide ");
         
         for (int j=0;j<listGrand.size();j++){
         Rang list3 =(Rang) listGrand.get(j);
          
         
          if(
              (R1 >= Long.parseLong(list3.getStart()) &&  R2<= Long.parseLong(list3.getEnd())&& nn.equals(list3.getArticle())&& nn1_grand.equals(list3.getProfil())) 
              )
          {
           System.out.println("j de la grande="+j);
           System.out.println("j'ai trouvé un element ds la grand ");
           
           ///   ndl <= parseLong(list3.getStart()) <= nfl
           trouver=true;
           existe=true;
           
           break;
          
            
          }/// end if teste coll grande
          
         
              
           }//// end for coll grande
         
         if (existe.equals(false)){
         sortiForm.setHiddenTest("range n'est pas dans la coll grande"); 
          System.out.println("range n'existe pas dans la collection grande");
          
         sortiForm.setArticle("");
      sortiForm.setProfil("");
      sortiForm.setDebut("");
      sortiForm.setFin("");
         
           return mapping.findForward("sortie");
         }
         
         else{
          
         
         
              //   calculer la quantité
       
       
        
        // remplir la collection
       rang2.setAa(nn);
      rang2.setProff(nn1);
      rang2.setStt(nn2);
      rang2.setEndd(nn3);
      rang2.setQtt(qute);
      
      rang2.setAaa(nn);
      rang2.setPpp(nn1);
      rang2.setSt(nn2);
      rang2.setSee(nn3);
      rang2.setQt(qute);
       
        list.add(rang2);
        
       
         for (int j=0; j<list.size();j++){
         System.out.println("dans le for");
         System.out.println("j ="+j);
         
         Rang3 list3 = (Rang3)list.get(j);
          
           if ((list3.getAa().equals("")))  
          {
           System.out.println("dans le if");
          }
              else{
           nouv.add(list3);
           System.out.println("dans le else");
          
          }
          
        }
       
       trouver=true;
       sortiForm.setListajouter(nouv);
       sortiForm.setHiddenTest("");
         //break;
       
        }// end if ""
   }// ende else existe
    
    
          
    else{
     for (int i=0; i<list.size();i++){
       Rang3 list2 = (Rang3)list.get(i);
       
      if (list2.getAa().equals("")){
             
             System.out.println("la 1ere ligne vide");
             
             for (int j=0;j<listGrand.size();j++){
             Rang list3 =(Rang) listGrand.get(j);
              
             
              if(
                  (R1 >= Long.parseLong(list3.getStart()) &&  R2<= Long.parseLong(list3.getEnd())&& nn.equals(list3.getArticle())&& nn1_grand.equals(list3.getProfil())) 
                  )
              {
              System.out.println("j de la grand="+j);
               
               ///   ndl <= parseLong(list3.getStart()) <= nfl
               trouver=true;
               existe=true;
               
               break;
              
                
              }/// end if teste coll grande
              
             
                  
               }//// end for coll grande
             
             if (existe.equals(false)){
             sortiForm.setHiddenTest("range n'est pas dans la coll grande"); 
              System.out.println("range n'existe pas dans la collection grande");
              
             sortiForm.setArticle("");
          sortiForm.setProfil("");
          sortiForm.setDebut("");
          sortiForm.setFin("");
             
               return mapping.findForward("sortie");
             }
             
             else{
              
             
             
                       //   calculer la quantité
          
          
           
           // remplir la collection
          rang2.setAa(nn);
         rang2.setProff(nn1);
         rang2.setStt(nn2);
         rang2.setEndd(nn3);
         rang2.setQtt(qute);
         
         rang2.setAaa(nn);
         rang2.setPpp(nn1);
         rang2.setSt(nn2);
         rang2.setSee(nn3);
         rang2.setQt(qute);
          
           list.add(rang2);
           
          
            for (int j=0; j<list.size();j++){
            System.out.println("dans le for");
            System.out.println("j ="+j);
            
            Rang3 list3 = (Rang3)list.get(j);
             
              if ((list3.getAa().equals("")))  
             {
              System.out.println("dans le if");
             }
                 else{
              nouv.add(list3);
              System.out.println("dans le else");
             
             }
             
           }
          
          trouver=true;
          sortiForm.setListajouter(nouv);
          sortiForm.setHiddenTest("");
             break;
           
            }// end if ""
      }// ende else existe
       
          ///// si la collection est non vide
            
         else{
             
             System.out.println("la 1ere ligne non vide");
             
             sortiForm.setHiddenTest("");
                 
             if(
               (Long.parseLong(nn2)>= Long.parseLong(list2.getSt()) )&& (Long.parseLong(nn3)<= (Long.parseLong(list2.getSee()) )&& nn.equals(list2.getAa())&& nn1.equals(list2.getProff()))
               ||
               (Long.parseLong(list2.getSt())>=Long.parseLong(nn2) && Long.parseLong(list2.getSt())<=Long.parseLong(nn3) && nn.equals(list2.getAa())&& nn1.equals(list2.getProff()))
               ||
               (Long.parseLong(list2.getSee())>=Long.parseLong(nn2) && Long.parseLong(list2.getSee())<=Long.parseLong(nn3)&& nn.equals(list2.getAa())&& nn1.equals(list2.getProff()))
             
                )
             {
              sortiForm.setHiddenTest("range dans la coll"); 
               System.out.println("range existe dans la collection");
               trouver=true;
               existe2= true;
               existe=true;
               
               break;
             }//// end if collection
             
         }//// end for
             
              
             if(existe2.equals(false))
              {
              //// n'existe pas dans la petite coll
              
               for (int j=0;j<listGrand.size();j++){
               Rang list3 =(Rang) listGrand.get(j);
               
               
               
                if(
                 (R1 >= Long.parseLong(list3.getStart()) &&  R2<= Long.parseLong(list3.getEnd())&& nn.equals(list3.getArticle())&& nn1_grand.equals(list3.getProfil())) 
                    
                  )
               
                {
                // trouver=true;
                 existe=true;
                 
                 break;
                
                  
                }/// end if teste coll grande
                
               
                }//// end for coll grande
            }// end if existe2
            
            }/// end else " "
    }   
       if (existe.equals(false)){
        sortiForm.setHiddenTest("range n'est pas dans la coll grande"); 
          System.out.println("range n'existe pas dans la collection grande");
          
          sortiForm.setArticle("");
       sortiForm.setProfil("");
       sortiForm.setDebut("");
       sortiForm.setFin("");
         
           return mapping.findForward("sortie");
         }
           
     
      
      
       if (trouver.equals(false))
       {
        sortiForm.setHiddenTest("");
          
          System.out.println("rang n'existe pas dans la collection ");
          
          // calculer la quantité
         
          
          // remplir la collection
         rang2.setAa(nn);
       rang2.setProff(nn1);
       rang2.setStt(nn2);
       rang2.setEndd(nn3);
       rang2.setQtt(qute);
       
       rang2.setAaa(nn);
       rang2.setPpp(nn1);
       rang2.setSt(nn2);
       rang2.setSee(nn3);
       rang2.setQt(qute);
         
          list.add(rang2);
         
         sortiForm.setListajouter(list); 
       }
        

      sortiForm.setArticle("");
      sortiForm.setProfil("");
      sortiForm.setDebut("");
      sortiForm.setFin("");
 
    
    
   return mapping.findForward("sortie");
  }
    
 
   public ActionForward Retirer(ActionMapping mapping, ActionForm form,
      HttpServletRequest request, HttpServletResponse response) throws SQLException,IOException, ServletException {
    SortiForm sortiForm = (SortiForm) form;
     List list=null;
     ArrayList nouv= new ArrayList();
     
     list = sortiForm.getListajouter();
     String art = request.getParameter("aaa");
     System.out.println("arti"+art);
     String prof = request.getParameter("ppp");
     System.out.println("prof"+prof);
     String ser_str = request.getParameter("st");
     System.out.println("serial_str"+ser_str);
     String ser_end = request.getParameter("see");
     System.out.println("serial_end"+ser_end);
     String quante = request.getParameter("qt");
     System.out.println("qte"+quante);
     
     System.out.println("colle"+list.size());
     for (int i=0; i<list.size();i++){
     
     Rang3 list2= (Rang3)list.get(i); 
     System.out.println("dans le for");
     
     Rang3 pre = new Rang3();
    
     System.out.println(i);
     System.out.println("soum"+list2.getAa());
     
     if ((list2.getAa().equals(art))&&(list2.getProff().equals(prof))&&(list2.getEndd().equals(ser_end))&&(list2.getStt().equals(ser_str))) 
     {
      System.out.println("dans le if");
     }
     else{
      nouv.add(list2);
      System.out.println("dans le else");
     }
     
     }
     
     sortiForm.setListajouter(nouv);
     sortiForm.setHiddenTest("");
     return mapping.findForward("sortie"); 
     }
 
 
 
 
 
    
 
    
    public String getResult(String Str)
    {
     return ((Str != null) ? Str=Str.trim():Str); 
    }
    
    
    public String setResult(String Str)
    {
     return ((Str != null) ? Str : null); 
    }
    
    
    
    
    public ActionForward valider(ActionMapping mapping, ActionForm form,
      HttpServletRequest request, HttpServletResponse response) throws SQLException,IOException, ServletException  {
     SortiForm sortiForm = (SortiForm) form;
     
     
     Connexion connexion=new Connexion();
     Connection con=connexion.createConnection();
     
     
     String idpart = null,idact=null,idart,idprof,maxrng=null,res1=null,res2,start,end,tra,wh,
     no,whp,pfp,arp,rp,acp,pq,statu,swap,promo,prior,p,t,s,r,sta2=null,end2,res3=null;
     Statement st,st1,st2,st3,st4,st5,st6,st7,st8,st9,st10,st11,st12,st13,st14,st15 = null;
     ResultSet rs,rs1,rs2,rs3,rs4,rs5,rs6,rs8,rs13,rs14,rs15 = null;
     int h,h1,h2,h3,h4,h5,h6,h7,h8,h9;
     Integer I2;
     Number P=0;
     long R2,R3,I=0,Res2=0,I1=0;
     List listt;
     String whh=null,max=null,reserv=null,whsregion=null;
     ArrayList priv =  new ArrayList() ;
     String proff=null;
     
     
     
     
     st=con.createStatement();
     st1=con.createStatement();
     st2=con.createStatement();
     st3=con.createStatement();
     st4=con.createStatement();
     st5=con.createStatement();
     st6=con.createStatement();
     st7=con.createStatement();
     st8=con.createStatement();
     st9=con.createStatement();
     st10=con.createStatement();
     st11=con.createStatement();
     st12=con.createStatement();
     st13=con.createStatement();
     max = (String)request.getSession().getAttribute("max");
     System.out.println(max);
     
     String mm= (String)request.getSession().getAttribute("username");
     System.out.println(mm);
      
     
      whh= (String)request.getSession().getAttribute("warehousenvoi");
     System.out.println(whh); 
     
     
     
     
     String code= (String)request.getSession().getAttribute("code");
     System.out.println(code);
     
     
     
    
     
    
     
    
     
     String note=sortiForm .getNote();
     System.out.println(note);
     
     String doc=sortiForm .getDoc();
     System.out.println(doc);
     
     
     
     con.setAutoCommit(false);
     
     
     rs3=st3.executeQuery("select ACT_ID from gss_actor where act_name='"+mm+"'");
     
     
     
    

     
     while (rs3.next())
        {
                     
         idact = rs3.getString(1).trim();
        System.out.println(idact);
         }
     
     
     rs3=null;st3=null;
     st3=con.createStatement();
     
     rs3=st3.executeQuery("select w.whs_region from gss_warehouse w where w.whs_id='"+whh+"'");
     
     
     while (rs3.next())
        {
                     
         whsregion = rs3.getString(1).trim();
        System.out.println(whsregion);
         }
/*
     try{
       rs4=st4.executeQuery("select max(rng_id) from gss_range where ACT_ID='"+idact+"'");
       
       if (rs4.next()){
           maxrng=rs4.getString(1).trim();
          System.out.println(maxrng);
          
          R2=Long.parseLong(maxrng);
          R2=R2+1;
       res1=Long.toString(R2);
       System.out.println(res1);
          
          }
       
       
      }
       
        
         catch (Exception e) {
         
         res1 = "1000000000";
         
        }
       */
     
     listt=sortiForm .getListajouter();
     
     
     
      
      
      /*   if (prof!="_"){
         rs6=st6.executeQuery("select profil_id from gss_article_profil where profil_libelle='"+prof+"'");
         
         if (rs6.next()){
            idprof=rs6.getString(1).trim();
           System.out.println(idprof);
           }
         }*/
    /* System.out.println("insert into gss_transaction values ('"+max+"','REI','"+whh+"',SYSDATE,'"+idact+"',(select dest_id from gss_transaction where trans_no='"+code+"' and trans_type='TRE'),'"+doc+"','"+note+"','','','')");
      h = st.executeUpdate("insert into gss_transaction values ('"+max+"','REI','"+whh+"',SYSDATE,'"+idact+"',(select dest_id from gss_transaction where trans_no='"+code+"' and trans_type='TRE'),'"+doc+"','"+note+"','','','')");
     */
      
      
      int size=listt.size();
     System.out.println(size);
     
     
         
         if (size==0){
         System.out.println("la collection est vide"); 
         
        sortiForm.setHiddenTest("collection null");
         
           return mapping.findForward("sortie");
          
         }
         else
          
         {
          
          System.out.println("insert into gss_transaction values ('"+max+"','SOR','"+whh+"',SYSDATE,'"+idact+"',(select dest_id from gss_transaction where trans_no='"+code+"' and trans_type='ASO'),'"+doc+"','"+note+"','','','','','N')");
        
        h = st.executeUpdate("insert into gss_transaction values ('"+max+"','SOR','"+whh+"',SYSDATE,'"+idact+"',(select dest_id from gss_transaction where trans_no='"+code+"' and trans_type='ASO'),'"+doc+"','"+note+"','','','','','N')");
       
      
      for (int i=0;i<listt.size();i++)
      {
       System.out.println(i);
       Rang3 rn = (Rang3)listt.get(i); 
       System.out.println("aa="+rn.getAa());
                System.out.println("pp="+rn.getProff());
       System.out.println("st="+rn.getStt());
       System.out.println("se="+rn.getEndd());
       System.out.println("qt="+rn.getQtt());
       
       
       
       String art=rn.getAa();
       System.out.println(art);
       
       if (art.equals("")){
        System.out.println("la collection est vide"); 
           
        sortiForm.setHiddenTest("collection null");
           
             return mapping.findForward("sortie");
            
           
       }
       
        try{
         rs4=st4.executeQuery("select max(rng_id) from gss_range where ACT_ID='"+idact+"'");
         
         if (rs4.next()){
             maxrng=rs4.getString(1).trim();
            System.out.println(maxrng);
            
            R2=Long.parseLong(maxrng);
            R2=R2+1;
         res1=Long.toString(R2);
         System.out.println(res1);
            
            }
         
         
        }
         
          
           catch (Exception e) {
           
           res1 = "1000000000";
           
          }
       
       String prof=rn.getProff();
       System.out.println(prof);
       String sta=rn.getStt();
       System.out.println(sta);
       String ind=rn.getEndd();
       System.out.println(ind);
      
      
      System.out.println("tous va bien");
       
      
      rs2=st2.executeQuery("select rng_start,rng_end,rng_id,act_id,profil_id,art_id,rng_pq,rng_statut,rng_swap,trans_type,whs_id,trans_no,rng_promotion,rng_priorite,rng_packaged,rng_transfert,rng_sortie,rng_reintegration,rng_whs,rng_dist,rng_packaging_whs,rng_sortie_whs,rng_reintegration_whs,rng_transfert_whs from gss_range r where (rng_inactif ='A')   and r.rng_sortie='O' ");   
      
       
        
        
      
        while (rs2.next()){
         System.out.println("dans le while");
         
          
         
         start = rs2.getString(1).trim();
         System.out.println("1"+start);
         
         end = rs2.getString(2).trim();
         System.out.println("2"+end);
         
         rp=rs2.getString(3).trim();
         System.out.println("3"+rp);
         
         acp=rs2.getString(4).trim();
         System.out.println("4"+acp);
         
         pfp=getResult(rs2.getString(5));
           System.out.println("5"+pfp);
         
         
         arp=rs2.getString(6).trim();
         System.out.println("6"+arp);
         
         
        pq=getResult(rs2.getString(7));
           System.out.println("7"+pq);
         
         statu=rs2.getString(8).trim();
          System.out.println("8"+statu);
         
         swap=getResult(rs2.getString(9));
           System.out.println("9"+swap);
         
           
       /*  tra = rs2.getString(10).trim();
         
         wh=rs2.getString(11).trim();
         no=rs2.getString(12).trim();*/
         
         
         promo=getResult(rs2.getString(13));
           System.out.println(promo);
           
        
         
         prior=getResult(rs2.getString(14));
           System.out.println(prior);
         
         p=rs2.getString(15).trim();
         t=rs2.getString(16).trim();
         s=rs2.getString(17).trim();
         r=rs2.getString(18).trim();
         
         whp=rs2.getString(19).trim();
        
            String dist=getResult(rs2.getString(20));
            System.out.println("20"+dist);
            
            
            String whspack=getResult(rs2.getString(21));
          System.out.println("21"+whspack);
         
          String whssor=getResult(rs2.getString(22));
          System.out.println("22"+whssor);
          
          String whsrentegr=getResult(rs2.getString(23));
          System.out.println("23"+whsrentegr);
          
          
          String whstransfert=getResult(rs2.getString(24));
                 System.out.println("24"+whstransfert);
        
        
        
        
        
       
       
       
       /*************** rang entier*******************************/
       
       if((sta.equals(start))&&(ind.equals(end)))
       { 
        System.out.println("dans le 1er if");
        
        
        
        h2 = st7.executeUpdate("insert into gss_range values ('"+res1+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+sta+"','"+ind+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'SOR','"+whh+"','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','S','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),(select dest_id from gss_transaction where trans_no='"+code+"' and trans_type='ASO'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
        
        h3 = st9.executeUpdate("insert into gss_transaction_range values ('SOR','"+whh+"','"+max+"','"+res1+"','"+idact+"',SYSDATE)");
        
      
        
        
        h3 = st9.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res1+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
        
       
        h8 = st12.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
        
        
       
       break;
       }
       
       else{
        System.out.println("dans le else1");
       }
       
       
       
       
                   /**********  le 1er rang********************/
       
       
       /*Res1=Long.parseLong(sta);
       Res2=Long.parseLong(ind);*/
       
       
       
          
        if((sta.equals(start))&&(Long.parseLong(ind)< Long.parseLong(end)) )
       {
        System.out.println("dans le 2eme if");
        
        I=Long.parseLong(ind);
        I=I+1;
        sta2=Long.toString(I);
        
        
        
              
                       h2 = st7.executeUpdate("insert into gss_range values ('"+res1+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+sta+"','"+ind+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'SOR','"+whh+"','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','S','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),(select dest_id from gss_transaction where trans_no='"+code+"' and trans_type='ASO'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
        
        h3 = st9.executeUpdate("insert into gss_transaction_range values ('SOR','"+whh+"','"+max+"','"+res1+"','"+idact+"',SYSDATE)");
        
        R3=Long.parseLong(res1);
        R3=R3+1;
        res2=Long.toString(R3);
          System.out.println(res2);
        
        h4 = st10.executeUpdate("insert into gss_range values ('"+res2+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+sta2+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
        
       
        
        
        h3 = st9.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res1+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
        
       
       h1 = st11.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res2+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
        
       
       h8 = st12.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
       break; 
       }
       else 
       {
        System.out.println("dans le else2");
       }
       
       
       
       
       
       
       
        /*****************2er partie***************/
       
     if((Long.parseLong(sta)> Long.parseLong(start))&&(ind.equals(end)) )
       
       
       {
        System.out.println("dans le 3eme if");
        
        
        
                 h2 = st7.executeUpdate("insert into gss_range values ('"+res1+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+sta+"','"+ind+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'SOR','"+whh+"','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','S','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),(select dest_id from gss_transaction where trans_no='"+code+"' and trans_type='ASO'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
        
        
        
        h3 = st9.executeUpdate("insert into gss_transaction_range values ('SOR','"+whh+"','"+max+"','"+res1+"','"+idact+"',SYSDATE)");
        
        
        I=Long.parseLong(sta);
        I=I-1;
        end2=Long.toString(I);
        
        R3=Long.parseLong(res1);
        R3=R3+1;
        res2=Long.toString(R3);
          System.out.println(res2);
        
        h4 = st10.executeUpdate("insert into gss_range values ('"+res2+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+end2+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
       
        
        h3 = st9.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res1+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'"); 
       
        h1 = st11.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res2+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
       
        h8 = st12.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
        
        
       break; 
       }
       else 
       {
        System.out.println("dans le else3");
       }
       
      
       
       
       /* 3 parties*/
        if((Long.parseLong(sta)> Long.parseLong(start))&&(Long.parseLong(ind)< Long.parseLong(end)))
          
       
       {
        System.out.println("dans le 4eme if");
        
                  h2 = st7.executeUpdate("insert into gss_range values ('"+res1+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+sta+"','"+ind+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'SOR','"+whh+"','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','S','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),(select dest_id from gss_transaction where trans_no='"+code+"' and trans_type='ASO'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
        
        
        
        h3 = st9.executeUpdate("insert into gss_transaction_range values ('SOR','"+whh+"','"+max+"','"+res1+"','"+idact+"',SYSDATE)");
        
        
        I=Long.parseLong(sta);
        I=I-1;
        end2=Long.toString(I);
        
        I1=Long.parseLong(ind);
        I1=I1+1;
        sta2=Long.toString(I1);
        
        
        R3=Long.parseLong(res1);
        R3=R3+1;
        res2=Long.toString(R3);
          System.out.println(res2);
        
        h4 = st10.executeUpdate("insert into gss_range values ('"+res2+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+end2+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
        
        R3=R3+1;
        res3=Long.toString(R3);
          System.out.println(res3);
        
         h5 = st7.executeUpdate("insert into gss_range values ('"+res3+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+sta2+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
         
        
         
         
         h3 = st9.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res1+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'"); 
        
         h1 = st11.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res2+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
         
         h7 = st6.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res3+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
         
         h8 = st12.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
        
        break;
        
        
       }
       else 
       {
        System.out.println("dans le 4 else");
       }
       
        }
      
      
        }
   
      
     }
       
       
       
        st12=null;
       st12=con.createStatement();
         rs13=st13.executeQuery("select nvl(trans_ext_ref,'_') from gss_transaction t where trans_no='"+code+"' and trans_type='ASO'");   
       while (rs13.next()){
       System.out.println("je cherche le code de reserv");
      
       reserv = rs13.getString(1).trim();
       System.out.println("le code reserv"+reserv);
       }
       
       if (reserv.equals("_"))
       {
        System.out.println(" y'a pas une réservation ");
       }
       else{
       String txt = reserv.substring(0,3);
      System.out.println("txt="+txt);
      String txt1 = reserv.substring(4,7);
      System.out.println("txt1="+txt1);
      String txt2 = reserv.substring(8);
      System.out.println("txt2="+txt2);
      
     // rs13=null;st13=null;
     // st13=con.createStatement();
      st14=con.createStatement();
      st15=con.createStatement();
      System.out.println("select r.art_id,nvl(p.profil_libelle,'_'),nvl(r.rng_pq,'_'),case when a.art_type_id in ('S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr (r.rng_start, 5, 1)) else '_' end hlr,sum(r.rng_end-r.rng_start+1),nvl(r.rng_swap,'_') from gss_range r ,gss_article a  ,gss_article_profil p where (a.art_id=r.art_id) and p.profil_id(+)=r.profil_id and r.trans_type='SOR' and r.whs_id='"+whh+"' and r.trans_no='"+max+"' group by  r.art_id,p.profil_libelle,r.rng_pq,case when a.art_type_id in ('S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr (r.rng_start, 5, 1)) else '_' end,nvl(r.rng_swap,'_')");
      
      rs15=st15.executeQuery("select r.art_id,nvl(p.profil_libelle,'_'),nvl(r.rng_pq,'_'),case when a.art_type_id in ('S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr (r.rng_start, 5, 1)) else '_' end hlr,sum(r.rng_end-r.rng_start+1),nvl(r.rng_swap,'_') from gss_range r ,gss_article a  ,gss_article_profil p where (a.art_id=r.art_id) and p.profil_id(+)=r.profil_id and r.trans_type='SOR' and r.whs_id='"+whh+"' and r.trans_no='"+max+"' group by  r.art_id,p.profil_libelle,r.rng_pq,case when a.art_type_id in ('S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr (r.rng_start, 5, 1)) else '_' end,nvl(r.rng_swap,'_')");
      while (rs15.next()){
       
      
       String art= rs15.getString(1).trim();
       System.out.println(art);
       if (rs15.getString(6).equals("SWAP"))
       {
        proff=getResult(rs15.getString(6)); 
        System.out.println(proff);
       }
       else{
        proff=getResult(rs15.getString(2));
        System.out.println(proff);
       }
      
       
       String pqq=getResult(rs15.getString(3));
       System.out.println(pqq);
       String hlr=getResult(rs15.getString(4));
       System.out.println(hlr);
       String qte=rs15.getString(5).trim();
      System.out.println(qte);
      
      System.out.println("select  v.art_id,v.profil_id,v.res_app_pq,v.res_app_hlr,v.qte_livree,v.quantite_article from gss_reserv_approb v where v.res_app_whs='CENTRE'and v.trans_type='"+txt+"' and v.whs_id='"+txt1+"' and v.trans_no='"+txt2+"' and v.livre='N'");
      rs14=st14.executeQuery("select  v.art_id,nvl(v.profil_id,'_'),nvl(v.res_app_pq,'_'),nvl(v.res_app_hlr,'_'),v.qte_livree,v.quantite_article from gss_reserv_approb v where v.res_app_whs='"+whsregion+"' and v.trans_type='"+txt+"' and v.whs_id='"+txt1+"' and v.trans_no='"+txt2+"' and v.livre='N'");
       
      
      while (rs14.next()){ 
       System.out.println(rs14.getString(1).trim());
       System.out.println(rs14.getString(2).trim());
       System.out.println(rs14.getString(3).trim());
       System.out.println(rs14.getString(4).trim());
       
       if (((art.equals(rs14.getString(1).trim())))&&
       (proff.equals(getResult(rs14.getString(2))))&&
       (pqq.equals(getResult(rs14.getString(3))))&&
       (hlr.equals(getResult(rs14.getString(4)))))
       {
        System.out.println("égale");
        Integer i=Integer.parseInt(qte)+Integer.parseInt(rs14.getString(5).trim());
        
        String qtt=Integer.toString(i);
        System.out.println("quantité calculé"+qtt);
        
        String qtt2=rs14.getString(6).trim();
        
        if (qtt.equals(qtt2))
        {
         System.out.println("quantité réservé"+qtt2);
         System.out.println("livré egale réservé");
         System.out.println("UPDATE gss_reserv_approb v SET v.qte_livree='"+qtt+"',v.livre='L' WHERE v.res_app_whs='"+whsregion+"' and v.trans_type='"+txt+"' and v.whs_id='"+txt1+"' and v.trans_no='"+txt2+"' and v.art_id='"+art+"' and  v.profil_id= '"+proff+"' and v.res_app_pq=  '"+pqq+"' and v.res_app_hlr= '"+hlr+"'");  
       
         h9 = st12.executeUpdate("UPDATE gss_reserv_approb v SET v.qte_livree='"+qtt+"',v.livre='L' WHERE v.res_app_whs='"+whsregion+"' and v.trans_type='"+txt+"' and v.whs_id='"+txt1+"' and v.trans_no='"+txt2+"' and v.art_id='"+art+"' and  v.profil_id= '"+proff+"' and v.res_app_pq=  '"+pqq+"' and v.res_app_hlr= '"+hlr+"'");  
        }
        else
         
        {
         System.out.println("livré n'est pas egale réservé");
         System.out.println("UPDATE gss_reserv_approb v SET v.qte_livree='"+qtt+"' WHERE v.res_app_whs='"+whsregion+"'and v.trans_type='"+txt+"' and v.whs_id='"+txt1+"' and v.trans_no='"+txt2+"' and v.art_id='"+art+"' and  v.profil_id= '"+proff+"' and v.res_app_pq=  '"+pqq+"' and v.res_app_hlr= '"+hlr+"'");  
       
         h9 = st12.executeUpdate("UPDATE gss_reserv_approb v SET v.qte_livree='"+qtt+"' WHERE v.res_app_whs='"+whsregion+"'and v.trans_type='"+txt+"' and v.whs_id='"+txt1+"' and v.trans_no='"+txt2+"' and v.art_id='"+art+"' and  v.profil_id= '"+proff+"' and v.res_app_pq=  '"+pqq+"' and v.res_app_hlr= '"+hlr+"'");  
          
        }
       }
      
      
      }
       
      }
      
      
      
     } 
       con.commit(); 
     
    ActionForward  forward = new RedirectingActionForward();
          forward.setPath("/afficher5.do");
          return forward; 
      
      //return null;
      
     // return mapping.findForward("envoipac");

      }
    
   } 

      
  