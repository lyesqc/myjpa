/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.yourcompany.struts.action;
import java.io.IOException;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.List;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.action.RedirectingActionForward;
import org.apache.struts.actions.DispatchAction;
import com.yourcompany.struts.UtilBean.Ordre;
import com.yourcompany.struts.UtilBean.Rang;
import com.yourcompany.struts.UtilBean.Rang3;
import com.yourcompany.struts.UtilClass.Connexion;
import com.yourcompany.struts.form.ApprobationForm;
import com.yourcompany.struts.form.PackagingForm;
import com.yourcompany.struts.form.SortiForm;
/** 
 * MyEclipse Struts
 * Creation date: 11-16-2008
 * 
 * XDoclet definition:
 * @struts.action path="/autosorti" name="sortiForm" parameter="hidden" validate="true"
 */
public class AutosortiAction extends DispatchAction {

 public ActionForward listaprob(ActionMapping mapping, ActionForm form,
   HttpServletRequest request, HttpServletResponse response) throws SQLException,IOException, ServletException  {
  SortiForm sortiForm = (SortiForm) form;// TODO Auto-genera
  
  Connexion connexion=new Connexion();
  Connection con=connexion.createConnection();
  
  Statement st,st1 = null;
  ResultSet rs,rs1 = null;
  Integer R,R1;
  String whs=null,whh=null;
  String prio=null;
  String date=null;
  
  ArrayList list = new ArrayList();
  ArrayList priv =  new ArrayList() ;
  
 /* whh=sortiForm.getMagasin();
  System.out.println(whh);
  
  st1=con.createStatement();
  
  rs1=st1.executeQuery("select whs_id from gss_warehouse where (gss_warehouse.whs_adresse='"+whh+"')");

  if (rs1.next()){
    
     whs=rs1.getString(1).trim();
    System.out.println(whs);
   
    
   }
  request.getSession().setAttribute("warehousenvoi",whs); 
  
  */
  
  
  
  st=con.createStatement();
  rs=st.executeQuery("select distinct v.trans_type,v.whs_id,v.trans_no,nvl(t.trans_ext_ref,'_'),d.dest_nom,v.trans_type||'-'||v.whs_id||'-'||v.trans_no from gss_reserv_approb v ,gss_destinataire d,gss_transaction t where (v.trans_type=t.trans_type and v.whs_id=t.whs_id and t.trans_no =v.trans_no and t.trans_type='RES' and v.whs_id='DIS' AND v.active='A' and V.LIVRE='N' AND t.approver='P' and v.annuler='N' and d.dest_id(+)=t.dest_id ) union select distinct v.trans_type,v.whs_id,v.trans_no,nvl(t.trans_ext_ref,'_'),d.dest_nom,v.trans_type||'-'||v.whs_id||'-'||v.trans_no from gss_reserv_approb v ,gss_destinataire d,gss_transaction t where (v.active='A' and V.LIVRE='N' and t.annuler='N' and d.dest_id(+)=t.dest_id  and v.trans_type=t.trans_type and v.whs_id=t.whs_id and t.trans_no =v.trans_no and t.trans_type='RES' AND v.whs_id<>'DIS')");
 
    
    
    while (rs.next()){
 Ordre ordre = new Ordre();
 ordre.setOrdre(rs.getString(4).trim());
 ordre.setType(rs.getString(1).trim()); 
 ordre.setCode(rs.getString(3).trim());
 ordre.setWhs(rs.getString(2).trim());
 ordre.setCodreserv(rs.getString(6).trim());
 ordre.setDistributeur(rs.getString(5).trim());
 ordre.setDist(rs.getString(5).trim());
 ordre.setCmd(rs.getString(4).trim());
list.add(ordre);
 
}
    
    
 sortiForm.setListeordre(list);

  
 return mapping.findForward("listaprob");
}
 
 public ActionForward ouvriraprob(ActionMapping mapping, ActionForm form,
   HttpServletRequest request, HttpServletResponse response) throws SQLException,IOException, ServletException  {
  
  SortiForm sortiForm = (SortiForm) form;
  
   
  Connexion connexion=new Connexion();
  Connection con=connexion.createConnection();
 
  ArrayList priv =  new ArrayList() ;
   String max=null;
   String art,prof,maxi;
   Integer R=0,R1=0;
   String prio=null;
   String date=null;
   Statement st,st1,st3,st4 = null;
   ResultSet rs,rs1,rs3,rs4 = null;
   ArrayList listprof = new ArrayList();
   ArrayList listart = new ArrayList();
   
ArrayList listtt = new ArrayList();
ArrayList list2 = new ArrayList();
st=con.createStatement();
st1=con.createStatement();
st3=con.createStatement();
st4=con.createStatement();
 
/*
String whs= (String)request.getSession().getAttribute("warehousenvoi");
System.out.println(whs);*/
 
String codreserv = request.getParameter("codreserv");
System.out.println("codreserv"+codreserv);

String code = request.getParameter("code");
System.out.println("code"+code);
request.getSession().setAttribute( "code",code);
 
String type= request.getParameter("type");
System.out.println("type"+type);
request.getSession().setAttribute( "type",type);
String whs = request.getParameter("whs");
System.out.println("code resrevation"+whs);
request.getSession().setAttribute( "whs",whs);
String dist = request.getParameter("dist");
System.out.println("distinataire"+dist);

String cmd = request.getParameter("cmd");
System.out.println("num de commande"+cmd);
 

System.out.println("select distinct v.trans_type,v.whs_id,v.trans_no,v.res_app_whs,a.art_art_libelle,nvl(v.profil_id,'_'),v.quantite_article-v.qte_livree,nvl(v.res_app_hlr,'_'),nvl(v.res_app_pq,'_') from gss_reserv_approb v ,gss_destinataire d  ,gss_article a where (a.art_id=v.art_id)  and v.trans_no ='"+code+"'  and v.trans_type='"+type+"' and v.whs_id='"+whs+"'");
rs=st.executeQuery("select distinct v.trans_type,v.whs_id,v.trans_no,v.res_app_whs,a.art_art_libelle,nvl(v.profil_id,'_'),v.quantite_article-v.qte_livree,nvl(v.res_app_hlr,'_'),nvl(v.res_app_pq,'_') from gss_reserv_approb v ,gss_destinataire d  ,gss_article a where (a.art_id=v.art_id)  and v.trans_no ='"+code+"'  and v.trans_type='"+type+"' and v.whs_id='"+whs+"'");
 
while (rs.next())
 {
  
  System.out.println("["+rs.getString(1)+"],["+rs.getString(2)+"],["+rs.getString(3)+"],["+rs.getString(4)+"],["+rs.getString(5)+"]"+"],["+rs.getString(7)+"]");
 
  
  Rang rang=new Rang();
 if (rs.getString(7).trim().equals("0"))
 {
	} 
 else{
  rang.setMagasin(rs.getString(4).trim());
  rang.setArticle(rs.getString(5).trim());
  rang.setProfil(rs.getString(6).trim());
  rang.setPq(rs.getString(9).trim());
  rang.setHlr(rs.getString(8).trim());
  rang.setQte(rs.getString(7).trim());
  System.out.println(rs.getString(7).trim());
  

  sortiForm.setCodreserv(codreserv);
  sortiForm.setDis(dist);
  sortiForm.setCodaprob(cmd);
   
  listtt.add(rang);
  }

 }
   
sortiForm.setListaprob(listtt);
//sortiForm.setResulrang(list);
sortiForm.setHiddenTest(""); 
     
     System.out.println("c'est bon");
     
return mapping.findForward("affichaprob");
}
 
 
 
 
 
 public ActionForward afficher(ActionMapping mapping, ActionForm form,
   HttpServletRequest request, HttpServletResponse response) throws SQLException {
  SortiForm sortiForm = (SortiForm) form;// TODO Auto-generated method stub
 
  
  
  Connexion connexion=new Connexion();
  Connection con=connexion.createConnection();
  
  Statement st,st1,st2,st3,st4 = null;
  ResultSet rs,rs1,rs2,rs3,rs4 = null;
  String res,max=null;
  Integer R1,R2,I2,R;
  ArrayList list = new ArrayList();
  
  ArrayList list1 = new ArrayList();
  
  ArrayList listmag = new ArrayList();
  
  ArrayList listart = new ArrayList();
  ArrayList listprof = new ArrayList();
  
  ArrayList listdist = new ArrayList();
  
  
  
  st=con.createStatement();
  st1=con.createStatement();
  st2=con.createStatement();
  st3=con.createStatement();
  st4=con.createStatement();
  
  
  
  
 /* String mm= (String)request.getSession().getAttribute("username");
  System.out.println(mm);
  String whh = (String)request.getSession().getAttribute("werhs");
  System.out.println(whh);*/
  
  
 // rs=st.executeQuery("select distinct gss_article.art_art_libelle,gss_article_profil.profil_libelle,gss_range.rng_start,gss_range.rng_end,gss_range.rng_packaged,gss_range.rng_statut,case when gss_article.art_type_id in ('S1','S2') then decode(substr(gss_range.rng_start, 4, 1),'0', substr(gss_range.rng_start, 4, 2),'1', substr(gss_range.rng_start, 4, 2),'2', substr(gss_range.rng_start, 4, 2), '0' || substr(gss_range.rng_start, 5, 1)) else '_' end hlr,gss_range.rng_end-gss_range.rng_start+1 as qte from gss_range,gss_article, gss_article_profil,gss_warehouse where (gss_article.art_id=gss_range.art_id) and (gss_article_profil.profil_id (+) =gss_range.profil_id )and (gss_range.rng_packaged='N')and(gss_range.rng_inactif='A')");
  rs1 = st1.executeQuery("select whs_adresse from gss_warehouse where  whs_status='A' and gss_warehouse.whs_id <> 'W00'");
  rs2=st2.executeQuery("select dest_nom from gss_destinataire where dest_type not in ('PARTENAIRE','FOURNISSEUR')");
 rs=st.executeQuery("select art_art_libelle from gss_article,gss_article_type where (gss_article.art_type_id=gss_article_type.art_type_id) and (art_status='A') ");
 rs3=st3.executeQuery("select profil_libelle from gss_article_profil where profil_statut='A'"); 
 
 
 
  
  
  //packagingForm.setResulrang(list);

try{
rs4=st4.executeQuery("select max(trans_no) from gss_transaction where (trans_type='ASO')"); 
  
 
  
  while (rs4.next()){
          max=rs4.getString(1).trim();
          
         System.out.println(max);
         }
           
         R1=Integer.parseInt(max);
     R=R1+1;
    res=Integer.toString(R);
    System.out.println(res);
  
}  
  
catch (Exception e){
        res = "10000";
        //System.out.println("rs est null"); 
       }
    
    
      String afficher="ASO"+"-"+"W00"+"-"+res;
  
      sortiForm.setTransaction(afficher);
request.getSession().setAttribute("maxtrans", res);
 
 
 while (rs.next())
 {
              
 String art = rs.getString(1).trim();
 System.out.println(art);
 listart.add(art);
              
 }
 
 sortiForm.setListarticle(listart);
 
 while (rs3.next())
 {
              
 String prof = rs3.getString(1).trim();
 System.out.println(prof);
 listprof.add(prof);
              
 }
 
 sortiForm.setListprof(listprof); 
  
  while (rs1.next())
     {
                  
     String mag = rs1.getString(1).trim();
     System.out.println(mag);
     listmag.add(mag);
                  
     }
  
      
      System.out.println(listmag);
  
      
      
      sortiForm.setListmaga(listmag);
      
      
     
      
      
      while (rs2.next())
      {  
       
      String part=rs2.getString(1).trim();
      System.out.println(part);
      
       listdist.add(part);
      }
      
      System.out.println(listdist);
      
      sortiForm.setListdist(listdist);
      
      
 
  
//initialiser la 1ere collection avec des vides  
      
      
Rang3 rang3=new Rang3();
  
  
  rang3.setAa("");
  rang3.setProff("");
  rang3.setStt("");
  rang3.setEndd("");
  rang3.setQtt("");
  
  list1.add(rang3);
  
  sortiForm.setListajouter(list1);
  
  
 
  
//  initialiser la 2eme collection avec des vides  
  
  
  
  Rang rang=new Rang();
  
  rang.setArticle("");
  rang.setProfil("");
  rang.setStart("");
     rang.setEnd("");
  rang.setActive("");
  rang.setPackag("");
  rang.setQte("");
  rang.setPq("");
  rang.setHlr("");
  
  
  
  
  list.add(rang);
  sortiForm.setResulrang(list);
 
//inialiser les champs avec des vides 
  sortiForm.setArticle("");
  sortiForm.setDistination("");
sortiForm.setDebut("");
sortiForm.setFin("");
sortiForm.setMagasourc("");
sortiForm.setNote("");
sortiForm.setCodaprob("");
sortiForm.setProfil("");
sortiForm.setReserv("");
sortiForm.setDis("");
sortiForm.setMag("");
     
sortiForm.setHiddenTest("");   
      
  return mapping.findForward("auto");
 }

 public ActionForward chercher(ActionMapping mapping, ActionForm form,
   HttpServletRequest request, HttpServletResponse response) throws SQLException,IOException, ServletException  {
  
  SortiForm sortiForm = (SortiForm) form;// TODO Auto-generated method stub
  
  
  Connexion connexion=new Connexion();
  Connection con=connexion.createConnection();
  
  Statement st,st1,st2,st3 = null;
  ResultSet rs,rs1,rs2,rs3 = null;
  Integer R,R1;
  String codedist=null,type=null,codmag=null,requette;
  
  String  max=null,code=null;
  ArrayList list = new ArrayList();
  ArrayList list1 = new ArrayList();
  ArrayList mm = new ArrayList();
  ArrayList mm1 = new ArrayList();
  
  ArrayList listmag = new ArrayList();
  
  ArrayList listdist = new ArrayList();
  
  st=con.createStatement();
  st1=con.createStatement();
  st2=con.createStatement();
  st3=con.createStatement();
  String mag=sortiForm.getMagasourc();
  //String mag=sortiForm.getMag();
  System.out.println(mag);
  
  String dist=sortiForm.getDistination();
  System.out.println(dist);
  
  
  
  rs1=st1.executeQuery("select dest_id,dest_type from gss_destinataire d  where d.dest_nom='"+dist+"' and dest_type not in ('PARTENAIRE','FOURNISSEUR')");
  while (rs1.next())
  {
   codedist=rs1.getString(1).trim();
   System.out.println(codedist);
   
   type=rs1.getString(2).trim();
   System.out.println(type);
  }
  
  
  rs2=st2.executeQuery("select w.whs_id from gss_warehouse w where w.whs_adresse='"+mag+"'");
  while (rs2.next())
  {
   codmag=rs2.getString(1).trim();
         System.out.println(codmag);
   
  }
  
  
  requette = "select distinct a.art_art_libelle,nvl(p.profil_libelle,'_'),r.rng_start,r.rng_end,decode(r.rng_packaged, 'N', 'non package','O', 'ORDONNE', 'C', 'EN COUR','P','package', '_') PACKAGING,r.rng_statut,nvl(r.rng_swap,'_'),case when a.art_type_id in ('S1','S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr (r.rng_start, 5, 1)) else '_' end hlr,r.rng_end-r.rng_start+1 as qte,nvl(r.rng_pq,'_') from gss_range r,gss_article a, gss_article_profil p,gss_warehouse where (a.art_id=r.art_id) and (p.profil_id (+) =r.profil_id ) and a.art_art_libelle='SIM POSTPAID DJEZZY' and p.profil_libelle not in ('DJEZZY CONTROL','DJEZZY CLASSIC')and r.rng_inactif='A' and r.rng_statut='ACTIVE' AND r.rng_packaged='P'and r.rng_tpd is null and r.rng_sortie not in('O','S') and r.rng_whs= '"+codmag+"' and r.rng_transfert not in ('O','C')"+ 
" union "+ 
"select distinct gss_article.art_art_libelle,nvl(gss_article_profil.profil_libelle,'_'),r.rng_start,r.rng_end,decode(r.rng_packaged, 'N', 'non package', 'O', 'ORDONNE', 'C', 'EN COUR','P','package', '_') PACKAGING,r.rng_statut,nvl(r.rng_swap,'_'),case when gss_article.art_type_id in ('S1','S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr(r.rng_start, 5, 1)) else '_' end hlr,r.rng_end-r.rng_start+1 as qte,nvl(r.rng_pq,'_') from gss_range r,gss_article, gss_article_profil,gss_warehouse WHERE (gss_article.art_id=r.art_id) and (gss_article_profil.profil_id (+) =r.profil_id ) and gss_article.art_art_libelle in ('SIM PREPAID DJEZZY','SIM PREPAID ALLO')and r.rng_tpd is null and r.rng_sortie not in('O','S') and r.rng_whs= '"+codmag+"' and r.rng_statut='ACTIVE'  and r.rng_packaged='P' and r.rng_inactif='A' and r.rng_transfert not in ('O','C')"+
" union "+ 
"select distinct gss_article.art_art_libelle,nvl(gss_article_profil.profil_libelle,'_'),r.rng_start,r.rng_end,decode(r.rng_packaged, 'N', 'non package', 'O', 'ORDONNE', 'C', 'EN COUR','P','package', '_') PACKAGING,r.rng_statut,nvl(r.rng_swap,'_'),case when gss_article.art_type_id in ('S1','S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr(r.rng_start, 5, 1)) else '_' end hlr,r.rng_end-r.rng_start+1 as qte,nvl(r.rng_pq,'_') from gss_range r,gss_article, gss_article_profil,gss_warehouse,gss_article_type WHERE (gss_article.art_id=r.art_id) and (gss_article_profil.profil_id (+) =r.profil_id ) and gss_article.art_type_id=gss_article_type.art_type_id and gss_article_type.art_type_libelle='SCRATCH' and r.rng_statut='CHARGE'  and r.rng_inactif='A' and r.rng_tpd is null and r.rng_sortie not in('O','S') and r.rng_whs='"+codmag+"' and r.rng_transfert not in ('O','C')"; 
 
 
   System.out.println(requette);
 
 if (type.equals("CDS")||type.equals("CORPORATE")||type.equals("DISTRIBUTEUR"))
  {
   requette = requette +" union select distinct gss_article.art_art_libelle,nvl(gss_article_profil.profil_libelle,'_'),r.rng_start,r.rng_end,decode(r.rng_packaged, 'N', 'non package', 'O', 'ORDONNE', 'C', 'EN COUR','P','package', '_') PACKAGING,r.rng_statut,nvl(r.rng_swap,'_'),case when gss_article.art_type_id in ('S1','S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr(r.rng_start, 5, 1)) else '_' end hlr,r.rng_end-r.rng_start+1 as qte,nvl(r.rng_pq,'_') from gss_range r,gss_article, gss_article_profil,gss_warehouse,gss_article_type t WHERE (gss_article.art_id=r.art_id) and (gss_article_profil.profil_id (+) =r.profil_id ) and gss_article.art_type_id=t.art_type_id and gss_article.art_art_libelle= 'SIM POSTPAID DJEZZY' and gss_article_profil.profil_libelle in ('DJEZZY CONTROL','DJEZZY CLASSIC')and r.rng_inactif='A' and r.rng_statut='ACTIVE' AND r.rng_packaged='P'and r.rng_dist='"+dist+"' and r.rng_tpd is null and r.rng_sortie not in('O','S') and r.rng_whs= '"+codmag+"' and r.rng_transfert not in ('O','C')";
  }

   System.out.println(requette);
  
  rs=st.executeQuery(requette);
  
  
  
  
  while (rs.next())
  {
   
   System.out.println("["+rs.getString(1)+"],["+rs.getString(2)+"],["+rs.getString(3)+"],["+rs.getString(4)+"],["+rs.getString(5)+"],["+rs.getString(6)+"],["+rs.getString(7)+"],["+rs.getString(8)+"]");
   Rang rang=new Rang();
    
   rang.setArticle(rs.getString(1).trim());
   rang.setProfil(rs.getString(2).trim());
   
    rang.setStart(rs.getString(3).trim());
  
    rang.setEnd(rs.getString(4).trim());
   rang.setActive(rs.getString(6).trim());
   rang.setPackag(rs.getString(5).trim());
   rang.setQte(rs.getString(9).trim());
   rang.setHlr(rs.getString(8).trim());
  // rang.setSwap(rs.getString(7).trim());
   rang.setPq(rs.getString(10).trim());
   
   rang.setArt(rs.getString(1).trim());
   rang.setProf(rs.getString(2).trim());
   rang.setSt(rs.getString(3).trim());
   rang.setNd(rs.getString(4).trim());
   rang.setQt(rs.getString(9).trim());
   
   
   
   
   
   list.add(rang);
  }
  
  
  
  if (type.equals("CDS"))
  {
   
   st=null;
   rs=null;
   st=con.createStatement();
   rs=st.executeQuery("select distinct gss_article.art_art_libelle,nvl(gss_article_profil.profil_libelle,'_'),r.rng_start,r.rng_end,decode(r.rng_packaged, 'N', 'non package','O', 'ORDONNE', 'C', 'EN COUR','P','package', '_') PACKAGING,nvl(r.rng_statut,'_'),nvl(r.rng_swap,'_'),case when gss_article.art_type_id in ('S1','S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr(r.rng_start, 5, 1)) else '_' end hlr,r.rng_end-r.rng_start+1 as qte,nvl(r.rng_pq,'_') from gss_range r,gss_article, gss_article_profil,gss_warehouse,gss_article_type WHERE (gss_article.art_id=r.art_id) and (gss_article_profil.profil_id (+) =r.profil_id ) and r.rng_swap='SWAP'  and r.rng_inactif='A' and r.rng_tpd is null and r.rng_sortie not in ('O','S') and r.rng_whs= '"+codmag+"' and r.rng_transfert not in ('O','C')");
   
   while (rs.next())
   {
    
    System.out.println("["+rs.getString(1)+"],["+rs.getString(2)+"],["+rs.getString(3)+"],["+rs.getString(4)+"],["+rs.getString(5)+"],["+rs.getString(6)+"],["+rs.getString(7)+"],["+rs.getString(8)+"]");
    Rang rang=new Rang();
     
    rang.setArticle(rs.getString(1).trim());
    rang.setProfil(rs.getString(7).trim());
    
     rang.setStart(rs.getString(3).trim());
   
     rang.setEnd(rs.getString(4).trim());
    rang.setActive(rs.getString(6).trim());
    rang.setPackag(rs.getString(5).trim());
    rang.setQte(rs.getString(9).trim());
    rang.setHlr(rs.getString(8).trim());
   // rang.setSwap(rs.getString(7).trim());
    rang.setPq(rs.getString(10).trim());
    
    
    rang.setArt(rs.getString(1).trim());
    rang.setProf(rs.getString(7).trim());
    rang.setSt(rs.getString(3).trim());
    rang.setNd(rs.getString(4).trim());
    rang.setQt(rs.getString(9).trim());
    
    
    
    
    
    list.add(rang); 
   
 
  }
  }
  
 //articles pour technique et le it 
  /*
  
  if (type.equals("CDS"))
  {
   
   st=null;
   rs=null;
   st=con.createStatement();
   rs=st.executeQuery("select distinct gss_article.art_art_libelle,nvl(gss_article_profil.profil_libelle,'_'),r.rng_start,r.rng_end,r.rng_packaged,r.rng_statut,nvl(r.rng_swap,'_'),case when gss_article.art_type_id in ('S1','S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr(r.rng_start, 5, 1)) else '_' end hlr,r.rng_end-r.rng_start+1 as qte from gss_range r,gss_article, gss_article_profil,gss_warehouse,gss_article_type WHERE (gss_article.art_id=r.art_id) and (gss_article_profil.profil_id (+) =r.profil_id )   and r.rng_inactif='A' and r.rng_tpd is null and r.rng_sortie not in('O','S') and r.rng_whs= '"+codmag+"' and r.rng_packaged='N' and r.rng_statut='BRUTE' and r.rng_transfert not in ('O','C')");
   
   while (rs.next())
   {
    
    System.out.println("["+rs.getString(1)+"],["+rs.getString(2)+"],["+rs.getString(3)+"],["+rs.getString(4)+"],["+rs.getString(5)+"],["+rs.getString(6)+"],["+rs.getString(7)+"],["+rs.getString(8)+"]");
    Rang rang=new Rang();
     
    rang.setArticle(rs.getString(1).trim());
    rang.setProfil(rs.getString(2).trim());
    
     rang.setStart(rs.getString(3).trim());
   
     rang.setEnd(rs.getString(4).trim());
    rang.setActive(rs.getString(7).trim());
    rang.setPackag(rs.getString(5).trim());
    rang.setQte(rs.getString(9).trim());
    rang.setHlr(rs.getString(8).trim());
   // rang.setSwap(rs.getString(7).trim());
    
    
    rang.setArt(rs.getString(1).trim());
    rang.setProf(rs.getString(2).trim());
    rang.setSt(rs.getString(3).trim());
    rang.setNd(rs.getString(4).trim());
    rang.setQt(rs.getString(9).trim());
    
    
    
    
    
    list.add(rang); 
   
 
  }
  } 
  */
  
 /* 
  st=null;
  rs=null;
  st=con.createStatement();
  rs=st.executeQuery("select distinct gss_article.art_art_libelle,nvl(gss_article_profil.profil_libelle,'_'),gss_range.rng_start,gss_range.rng_end,gss_range.rng_packaged,gss_range.rng_statut,nvl(gss_range.rng_swap,'_'),case when gss_article.art_type_id in ('S1','S2') then decode(substr(gss_range.rng_start, 4, 1),'0', substr(gss_range.rng_start, 4, 2),'1', substr(gss_range.rng_start, 4, 2),'2', substr(gss_range.rng_start, 4, 2), '0' || substr(gss_range.rng_start, 5, 1)) else '_' end hlr,gss_range.rng_end-gss_range.rng_start+1 as qte,gss_range.rng_id from gss_range,gss_article, gss_article_profil,gss_warehouse,gss_article_type where (gss_article.art_id=gss_range.art_id) and (gss_article_profil.profil_id (+) =gss_range.profil_id ) and (gss_range.rng_whs=gss_warehouse.whs_id) and (gss_warehouse.whs_adresse='"+mag+"')and (gss_range.rng_inactif='A')and gss_range.rng_tpd is null  and gss_range.rng_swap='SWAP' and gss_range.rng_sortie='N'"); 
  
  
  while (rs.next())
  {
   
   System.out.println("["+rs.getString(1)+"],["+rs.getString(2)+"],["+rs.getString(3)+"],["+rs.getString(4)+"],["+rs.getString(5)+"],["+rs.getString(6)+"],["+rs.getString(7)+"],["+rs.getString(8)+"]");
   Rang rang=new Rang();
    
   rang.setArticle(rs.getString(1).trim());
   rang.setProfil(rs.getString(2).trim());
   
    rang.setStart(rs.getString(3).trim());
  
    rang.setEnd(rs.getString(4).trim());
   rang.setActive(rs.getString(7).trim());
   rang.setPackag(rs.getString(5).trim());
   rang.setQte(rs.getString(9).trim());
   rang.setHlr(rs.getString(8).trim());
  // rang.setSwap(rs.getString(7).trim());
   
   
   rang.setArt(rs.getString(1).trim());
   rang.setProf(rs.getString(2).trim());
   rang.setSt(rs.getString(3).trim());
   rang.setNd(rs.getString(4).trim());
   rang.setQt(rs.getString(9).trim());
   
   
   
   
   
   list.add(rang);
  }
  
  st=null;
  rs=null;
  st=con.createStatement();
  rs=st.executeQuery("select distinct gss_article.art_art_libelle,nvl(gss_article_profil.profil_libelle,'_'),gss_range.rng_start,gss_range.rng_end,gss_range.rng_packaged,gss_range.rng_statut,nvl(gss_range.rng_swap,'_'),case when gss_article.art_type_id in ('S1','S2') then decode(substr(gss_range.rng_start, 4, 1),'0', substr(gss_range.rng_start, 4, 2),'1', substr(gss_range.rng_start, 4, 2),'2', substr(gss_range.rng_start, 4, 2), '0' || substr(gss_range.rng_start, 5, 1)) else '_' end hlr,gss_range.rng_end-gss_range.rng_start+1 as qte,gss_range.rng_id from gss_range,gss_article, gss_article_profil,gss_warehouse,gss_article_type where (gss_article.art_id=gss_range.art_id) and(gss_article_profil.profil_id (+) =gss_range.profil_id ) and (gss_range.rng_whs=gss_warehouse.whs_id) and (gss_warehouse.whs_adresse='"+mag+"')and (gss_range.rng_inactif='A')and gss_range.rng_tpd is null  and gss_range.rng_statut= 'CHARGE' and gss_range.rng_sortie='N'");
  
  while (rs.next())
  {
   
   System.out.println("["+rs.getString(1)+"],["+rs.getString(2)+"],["+rs.getString(3)+"],["+rs.getString(4)+"],["+rs.getString(5)+"],["+rs.getString(6)+"],["+rs.getString(7)+"],["+rs.getString(8)+"]");
   Rang rang=new Rang();
    
   rang.setArticle(rs.getString(1).trim());
   rang.setProfil(rs.getString(2).trim());
   
    rang.setStart(rs.getString(3).trim());
  
    rang.setEnd(rs.getString(4).trim());
   rang.setActive(rs.getString(6).trim());
   rang.setPackag(rs.getString(5).trim());
   rang.setQte(rs.getString(9).trim());
   rang.setHlr(rs.getString(8).trim());
   //rang.setSwap(rs.getString(7).trim());
   
   
   rang.setArt(rs.getString(1).trim());
   rang.setProf(rs.getString(2).trim());
   rang.setSt(rs.getString(3).trim());
   rang.setNd(rs.getString(4).trim());
   rang.setQt(rs.getString(9).trim());
   
   
   
   
   
   list.add(rang);
  }
  */
  
  
  
  
  sortiForm.setResulrang(list);
  
 
  sortiForm.setHiddenTest("");
  return mapping.findForward("auto");
 }
 
 
 
 public ActionForward cherchreserv(ActionMapping mapping, ActionForm form,
		   HttpServletRequest request, HttpServletResponse response) throws SQLException,IOException, ServletException  {
		  
		  SortiForm sortiForm = (SortiForm) form;// TODO Auto-generated method stub
		  
		  
		  Connexion connexion=new Connexion();
		  Connection con=connexion.createConnection();
		  
		  Statement st,st1,st2,st3 = null;
		  ResultSet rs,rs1,rs2,rs3 = null;
		  Integer R,R1;
		  String codedist=null,type=null,codmag=null,requette;
		  
		  String  max=null,code=null;
		  ArrayList list = new ArrayList();
		  ArrayList list1 = new ArrayList();
		  ArrayList mm = new ArrayList();
		  ArrayList mm1 = new ArrayList();
		  
		  ArrayList listmag = new ArrayList();
		  
		  ArrayList listdist = new ArrayList();
		  
		  st=con.createStatement();
		  st1=con.createStatement();
		  st2=con.createStatement();
		  st3=con.createStatement();
	
		  
		  String dist=sortiForm.getDis();
		  System.out.println(dist);
		  
		  
		  
		  rs1=st1.executeQuery("select dest_id,dest_type from gss_destinataire d  where d.dest_nom='"+dist+"' and dest_type not in ('PARTENAIRE','FOURNISSEUR')");
		  while (rs1.next())
		  {
		   codedist=rs1.getString(1).trim();
		   System.out.println(codedist);
		   
		   type=rs1.getString(2).trim();
		   System.out.println(type);
		  }
		  
		  
		  rs2=st2.executeQuery("select w.whs_id from gss_warehouse w where w.whs_adresse='"+mag+"'");
		  while (rs2.next())
		  {
		   codmag=rs2.getString(1).trim();
		         System.out.println(codmag);
		   
		  }
		  
		  
		  requette = "select distinct a.art_art_libelle,nvl(p.profil_libelle,'_'),r.rng_start,r.rng_end,decode(r.rng_packaged, 'N', 'non package','O', 'ORDONNE', 'C', 'EN COUR','P','package', '_') PACKAGING,r.rng_statut,nvl(r.rng_swap,'_'),case when a.art_type_id in ('S1','S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr (r.rng_start, 5, 1)) else '_' end hlr,r.rng_end-r.rng_start+1 as qte,nvl(r.rng_pq,'_') from gss_range r,gss_article a, gss_article_profil p,gss_warehouse where (a.art_id=r.art_id) and (p.profil_id (+) =r.profil_id ) and a.art_art_libelle='SIM POSTPAID DJEZZY' and p.profil_libelle not in ('DJEZZY CONTROL','DJEZZY CLASSIC')and r.rng_inactif='A' and r.rng_statut='ACTIVE' AND r.rng_packaged='P'and r.rng_tpd is null and r.rng_sortie not in('O','S') and r.rng_whs= '"+codmag+"' and r.rng_transfert not in ('O','C')"+ 
		" union "+ 
		"select distinct gss_article.art_art_libelle,nvl(gss_article_profil.profil_libelle,'_'),r.rng_start,r.rng_end,decode(r.rng_packaged, 'N', 'non package', 'O', 'ORDONNE', 'C', 'EN COUR','P','package', '_') PACKAGING,r.rng_statut,nvl(r.rng_swap,'_'),case when gss_article.art_type_id in ('S1','S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr(r.rng_start, 5, 1)) else '_' end hlr,r.rng_end-r.rng_start+1 as qte,nvl(r.rng_pq,'_') from gss_range r,gss_article, gss_article_profil,gss_warehouse WHERE (gss_article.art_id=r.art_id) and (gss_article_profil.profil_id (+) =r.profil_id ) and gss_article.art_art_libelle in ('SIM PREPAID DJEZZY','SIM PREPAID ALLO')and r.rng_tpd is null and r.rng_sortie not in('O','S') and r.rng_whs= '"+codmag+"' and r.rng_statut='ACTIVE'  and r.rng_packaged='P' and r.rng_inactif='A' and r.rng_transfert not in ('O','C')"+
		" union "+ 
		"select distinct gss_article.art_art_libelle,nvl(gss_article_profil.profil_libelle,'_'),r.rng_start,r.rng_end,decode(r.rng_packaged, 'N', 'non package', 'O', 'ORDONNE', 'C', 'EN COUR','P','package', '_') PACKAGING,r.rng_statut,nvl(r.rng_swap,'_'),case when gss_article.art_type_id in ('S1','S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr(r.rng_start, 5, 1)) else '_' end hlr,r.rng_end-r.rng_start+1 as qte,nvl(r.rng_pq,'_') from gss_range r,gss_article, gss_article_profil,gss_warehouse,gss_article_type WHERE (gss_article.art_id=r.art_id) and (gss_article_profil.profil_id (+) =r.profil_id ) and gss_article.art_type_id=gss_article_type.art_type_id and gss_article_type.art_type_libelle='SCRATCH' and r.rng_statut='CHARGE'  and r.rng_inactif='A' and r.rng_tpd is null and r.rng_sortie not in('O','S') and r.rng_whs='"+codmag+"' and r.rng_transfert not in ('O','C')"; 
		 
		 
		   System.out.println(requette);
		 
		 if (type.equals("CDS")||type.equals("CORPORATE")||type.equals("DISTRIBUTEUR"))
		  {
		   requette = requette +" union select distinct gss_article.art_art_libelle,nvl(gss_article_profil.profil_libelle,'_'),r.rng_start,r.rng_end,decode(r.rng_packaged, 'N', 'non package', 'O', 'ORDONNE', 'C', 'EN COUR','P','package', '_') PACKAGING,r.rng_statut,nvl(r.rng_swap,'_'),case when gss_article.art_type_id in ('S1','S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr(r.rng_start, 5, 1)) else '_' end hlr,r.rng_end-r.rng_start+1 as qte,nvl(r.rng_pq,'_') from gss_range r,gss_article, gss_article_profil,gss_warehouse,gss_article_type t WHERE (gss_article.art_id=r.art_id) and (gss_article_profil.profil_id (+) =r.profil_id ) and gss_article.art_type_id=t.art_type_id and gss_article.art_art_libelle= 'SIM POSTPAID DJEZZY' and gss_article_profil.profil_libelle in ('DJEZZY CONTROL','DJEZZY CLASSIC')and r.rng_inactif='A' and r.rng_statut='ACTIVE' AND r.rng_packaged='P'and r.rng_dist='"+dist+"' and r.rng_tpd is null and r.rng_sortie not in('O','S') and r.rng_whs= '"+codmag+"' and r.rng_transfert not in ('O','C')";
		  }

		   System.out.println(requette);
		  
		  rs=st.executeQuery(requette);
		  
		  
		  
		  
		  while (rs.next())
		  {
		   
		   System.out.println("["+rs.getString(1)+"],["+rs.getString(2)+"],["+rs.getString(3)+"],["+rs.getString(4)+"],["+rs.getString(5)+"],["+rs.getString(6)+"],["+rs.getString(7)+"],["+rs.getString(8)+"]");
		   Rang rang=new Rang();
		    
		   rang.setArticle(rs.getString(1).trim());
		   rang.setProfil(rs.getString(2).trim());
		   
		    rang.setStart(rs.getString(3).trim());
		  
		    rang.setEnd(rs.getString(4).trim());
		   rang.setActive(rs.getString(6).trim());
		   rang.setPackag(rs.getString(5).trim());
		   rang.setQte(rs.getString(9).trim());
		   rang.setHlr(rs.getString(8).trim());
		  // rang.setSwap(rs.getString(7).trim());
		   rang.setPq(rs.getString(10).trim());
		   
		   rang.setArt(rs.getString(1).trim());
		   rang.setProf(rs.getString(2).trim());
		   rang.setSt(rs.getString(3).trim());
		   rang.setNd(rs.getString(4).trim());
		   rang.setQt(rs.getString(9).trim());
		   
		   
		   
		   
		   
		   list.add(rang);
		  }
		  
		  
		  
		  if (type.equals("CDS"))
		  {
		   
		   st=null;
		   rs=null;
		   st=con.createStatement();
		   rs=st.executeQuery("select distinct gss_article.art_art_libelle,nvl(gss_article_profil.profil_libelle,'_'),r.rng_start,r.rng_end,decode(r.rng_packaged, 'N', 'non package','O', 'ORDONNE', 'C', 'EN COUR','P','package', '_') PACKAGING,nvl(r.rng_statut,'_'),nvl(r.rng_swap,'_'),case when gss_article.art_type_id in ('S1','S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr(r.rng_start, 5, 1)) else '_' end hlr,r.rng_end-r.rng_start+1 as qte,nvl(r.rng_pq,'_') from gss_range r,gss_article, gss_article_profil,gss_warehouse,gss_article_type WHERE (gss_article.art_id=r.art_id) and (gss_article_profil.profil_id (+) =r.profil_id ) and r.rng_swap='SWAP'  and r.rng_inactif='A' and r.rng_tpd is null and r.rng_sortie not in ('O','S') and r.rng_whs= '"+codmag+"' and r.rng_transfert not in ('O','C')");
		   
		   while (rs.next())
		   {
		    
		    System.out.println("["+rs.getString(1)+"],["+rs.getString(2)+"],["+rs.getString(3)+"],["+rs.getString(4)+"],["+rs.getString(5)+"],["+rs.getString(6)+"],["+rs.getString(7)+"],["+rs.getString(8)+"]");
		    Rang rang=new Rang();
		     
		    rang.setArticle(rs.getString(1).trim());
		    rang.setProfil(rs.getString(7).trim());
		    
		     rang.setStart(rs.getString(3).trim());
		   
		     rang.setEnd(rs.getString(4).trim());
		    rang.setActive(rs.getString(6).trim());
		    rang.setPackag(rs.getString(5).trim());
		    rang.setQte(rs.getString(9).trim());
		    rang.setHlr(rs.getString(8).trim());
		   // rang.setSwap(rs.getString(7).trim());
		    rang.setPq(rs.getString(10).trim());
		    
		    
		    rang.setArt(rs.getString(1).trim());
		    rang.setProf(rs.getString(7).trim());
		    rang.setSt(rs.getString(3).trim());
		    rang.setNd(rs.getString(4).trim());
		    rang.setQt(rs.getString(9).trim());
		    
		    
		    
		    
		    
		    list.add(rang); 
		   
		 
		  }
		  }
	
		  sortiForm.setResulrang(list);
		  
		 
		  sortiForm.setHiddenTest("");
		  return mapping.findForward("auto");
		 }
 
 
 
  
  public ActionForward ajouter(ActionMapping mapping, ActionForm form,
    HttpServletRequest request, HttpServletResponse response) throws SQLException,IOException, ServletException  {
   SortiForm sortiForm = (SortiForm) form;
   
  // List listt;
   
  // ArrayList mm = new ArrayList();
  // ArrayList mm1 = new ArrayList();
   
   
   
   
   String nn=request.getParameter("art");
   String nn1=request.getParameter("prof");
   String nn2=request.getParameter("st");
   String nn3=request.getParameter("nd");
   String nn4=request.getParameter("qt");
   
   //request.getSession().setAttribute( "art",nn);
   //request.getSession().setAttribute( "prof",nn1);
   
   
   System.out.println(nn);
   System.out.println(nn1);
   System.out.println(nn2);
   System.out.println(nn3);
   System.out.println(nn4);
   
   
   sortiForm.setDebut(nn2);
   sortiForm.setFin(nn3);
   sortiForm.setArticle(nn);
   sortiForm.setProfil(nn1);
   
   sortiForm.setHiddenTest("");
   
   
   
   
  return mapping.findForward("auto");
 }
  
  public ActionForward ajouter1(ActionMapping mapping, ActionForm form,
    HttpServletRequest request, HttpServletResponse response) throws SQLException,IOException, ServletException  {
   SortiForm sortiForm = (SortiForm) form;// TODO Auto-genera
   
   
   String art,prof,nd,nf,qute,trouv=null;
   Long ndl,nfl,qte;
   List list=null;
   List listGrand=null;
   Statement st = null;
   ResultSet rs = null;
    Boolean trouver=false, existe= false, existe2=false;
    String  nn1_grand=null;
    
    Connexion connexion=new Connexion();
       Connection con=connexion.createConnection();
   
       ArrayList nouv=new ArrayList();
       
       
    
    Rang3 rang2=new Rang3();
    
    list = sortiForm.getListajouter();
    listGrand = sortiForm.getResulrang();
    
    art = sortiForm.getArticle();
    prof = sortiForm.getProfil();
    nd = sortiForm.getDebut();
    nf = sortiForm.getFin();
    
    nn1_grand=prof;
    if (prof.equals(""))
    {
      nn1_grand="_";
     System.out.println(nn1_grand);
     System.out.println("profil null"); 
    }
    
    
    ndl=Long.parseLong(nd);
    nfl=Long.parseLong(nf);
    qte=nfl-ndl+1;
    qute=Long.toString(qte);
    
    if (qte<=0){
     sortiForm.setHiddenTest("fin inferieur debut"); 
         System.out.println("le fin est< debut");
         
         sortiForm.setArticle("");
         sortiForm.setProfil("");
         sortiForm.setDebut("");
         sortiForm.setFin("");
        
          return mapping.findForward("auto");
        }
    
   
    
    int size=list.size();
    System.out.println(size);
  
        if (size==0){
     
        System.out.println("la collection est vide");
           
            for (int j=0;j<listGrand.size();j++){
            Rang list3 =(Rang) listGrand.get(j);
             
             
             /*boolean tmp = ( Long.parseLong(list3.getEnd())>=ndl && Long.parseLong(list3.getEnd())<=nfl  ) ;
             System.out.println("la bool = "+Boolean.toString(tmp));*/
             if(
                 (ndl >= Long.parseLong(list3.getStart()) &&  nfl<= Long.parseLong(list3.getEnd())&& art.equals(list3.getArticle())&& nn1_grand.equals(list3.getProfil())) 
                 )
             {
              
              
              ///   ndl <= parseLong(list3.getStart()) <= nfl
              trouver=true;
              existe=true;
              
              break;
             
               
             }/// end if teste coll grande
             
            
                 
              }//// end for coll grande
            
            if (existe.equals(false)){
             sortiForm.setHiddenTest("range n'est pas dans la coll grande"); 
             System.out.println("range n'existe pas dans la collection grande");
             
             sortiForm.setArticle("");
          sortiForm.setProfil("");
          sortiForm.setDebut("");
          sortiForm.setFin("");
            
              return mapping.findForward("auto");
            }
            
            else{
             
            
            
                       //   calculer la quantité
         
          qte=nfl-ndl+1;
          qute=Long.toString(qte);
         System.out.println(qute);
          
          // remplir la collection
         rang2.setAa(art);
         rang2.setProff(prof);
         rang2.setSt(nd);
         rang2.setStt(nd);
         rang2.setEndd(nf);
         rang2.setSee(nf);
         rang2.setQt(qute);
         rang2.setAaa(art);
         rang2.setPpp(prof);
         rang2.setQtt(qute);
         
          list.add(rang2);
          
         
           for (int j=0; j<list.size();j++){
           System.out.println("dans le for");
           System.out.println("j ="+j);
           
           Rang3 list3 = (Rang3)list.get(j);
            
             if ((list3.getAa().equals("")))  
            {
             System.out.println("dans le if");
            }
                else{
             nouv.add(list3);
             System.out.println("dans le else");
            
            }
            
          }
         
         trouver=true;
         sortiForm.setListajouter(nouv);
         sortiForm.setHiddenTest("");
            //break;
          
           }// end if ""  
       
        }
    
    
   //else de size 
    
        else    {
     
     for (int i=0; i<list.size();i++){
      Rang3 list2 = (Rang3)list.get(i);
       
      if (list2.getAa().equals("")){
             
             System.out.println("la 1ere ligne vide");
             
             for (int j=0;j<listGrand.size();j++){
             Rang list3 =(Rang) listGrand.get(j);
              
              /// (('"+R1+"'>=RNG_START) and ('"+R2+"'<=RNG_END)) or 
              ////(RNG_START between  '"+R1+"' and '"+R2+"' ) or (RNG_END between  '"+R1+"' and '"+R2+"' )
              
              /*boolean tmp = ( Long.parseLong(list3.getEnd())>=ndl && Long.parseLong(list3.getEnd())<=nfl  ) ;
              System.out.println("la bool = "+Boolean.toString(tmp));*/
              if(
                  (ndl >= Long.parseLong(list3.getStart()) &&  nfl<= Long.parseLong(list3.getEnd()) && art.equals(list3.getArticle())&& nn1_grand.equals(list3.getProfil())) 
                  )
              {
               
               
               ///   ndl <= parseLong(list3.getStart()) <= nfl
               trouver=true;
               existe=true;
               
               break;
              
                
              }/// end if teste coll grande
              
             
                  
               }//// end for coll grande
             
             if (existe.equals(false)){
              sortiForm.setHiddenTest("range n'est pas dans la coll grande"); 
              System.out.println("range n'existe pas dans la collection grande");
              
              sortiForm.setArticle("");
           sortiForm.setProfil("");
           sortiForm.setDebut("");
           sortiForm.setFin("");
             
               return mapping.findForward("auto");
             }
             
             else{
              
             
             
                        //   calculer la quantité
          
           qte=nfl-ndl+1;
           qute=Long.toString(qte);
          System.out.println(qute);
           
           // remplir la collection
          rang2.setAa(art);
          rang2.setProff(prof);
          rang2.setSt(nd);
          rang2.setStt(nd);
          rang2.setEndd(nf);
          rang2.setSee(nf);
          rang2.setQt(qute);
          rang2.setAaa(art);
          rang2.setPpp(prof);
          rang2.setQtt(qute);
          
           list.add(rang2);
           
          
            for (int j=0; j<list.size();j++){
            System.out.println("dans le for");
            System.out.println("j ="+j);
            
            Rang3 list3 = (Rang3)list.get(j);
             
              if ((list3.getAa().equals("")))  
             {
              System.out.println("dans le if");
             }
                 else{
              nouv.add(list3);
              System.out.println("dans le else");
             
             }
             
           }
          
          trouver=true;
          sortiForm.setListajouter(nouv);
          sortiForm.setHiddenTest("");
             break;
           
            }// end if ""
      }// ende else existe
       
          ///// si la collection est non vide
            
         else{
             
             System.out.println("la 1ere ligne non vide");
             
             sortiForm.setHiddenTest("");
                 
             if(
               (Long.parseLong(nd)>= Long.parseLong(list2.getSt()) )&& (Long.parseLong(nf)<= (Long.parseLong(list2.getSee()) ))  && art.equals(list2.getAa())&& prof.equals(list2.getProff())
               ||
               (Long.parseLong(list2.getSt())>=Long.parseLong(nd) && Long.parseLong(list2.getSt())<=Long.parseLong(nf))&& art.equals(list2.getAa())&& prof.equals(list2.getProff())
               ||
               (Long.parseLong(list2.getSee())>=Long.parseLong(nd) && Long.parseLong(list2.getSee())<=Long.parseLong(nf))&& art.equals(list2.getAa())&& prof.equals(list2.getProff())
             
                )
             {
              sortiForm.setHiddenTest("range dans la coll"); 
               System.out.println("range existe dans la collection");
               trouver=true;
               existe2= true;
               existe=true;
               
               break;
             }//// end if collection
             
         }//// end for
             
              
             if(existe2.equals(false))
              {
              //// n'existe pas dans la petite coll
              
               for (int j=0;j<listGrand.size();j++){
              Rang list3 =(Rang) listGrand.get(j);
               
               /// (('"+R1+"'>=RNG_START) and ('"+R2+"'<=RNG_END)) or 
               ////(RNG_START between  '"+R1+"' and '"+R2+"' ) or (RNG_END between  '"+R1+"' and '"+R2+"' )
                
               
                if(
                 (ndl >= Long.parseLong(list3.getStart()) &&  nfl<= Long.parseLong(list3.getEnd())&& art.equals(list3.getArticle())&& nn1_grand.equals(list3.getProfil())) 
                    
                  )
               
                {
                // trouver=true;
                 existe=true;
                 
                 break;
                
                  
                }/// end if teste coll grande
                
               
                }//// end for coll grande
            }// end if existe2
            
            }/// end else " "
     
  }
     
     if (existe.equals(false)){
          sortiForm.setHiddenTest("range n'est pas dans la coll grande"); 
          System.out.println("range n'existe pas dans la collection grande");
          
          sortiForm.setArticle("");
       sortiForm.setProfil("");
       sortiForm.setDebut("");
       sortiForm.setFin("");
         
           return mapping.findForward("auto");
         }
           
     
      
      
       if (trouver.equals(false))
       {
        sortiForm.setHiddenTest("");
           
          System.out.println("rang n'existe pas dans la collection ");
          
          // calculer la quantité
          qte=nfl-ndl+1;
          qute=Long.toString(qte);
         System.out.println(qute);
          
          // remplir la collection
         rang2.setAa(art);
         rang2.setProff(prof);
         rang2.setSt(nd);
         rang2.setStt(nd);
         rang2.setEndd(nf);
         rang2.setSee(nf);
         rang2.setQt(qute);
         rang2.setAaa(art);
         rang2.setPpp(prof);
         rang2.setQtt(qute);
         
          list.add(rang2);
         
         sortiForm.setListajouter(list); 
       }
          
          
        
   
   
   sortiForm.setArticle("");
   sortiForm.setProfil("");
   sortiForm.setDebut("");
   sortiForm.setFin("");
 
   
   
   
  return mapping.findForward("auto");
 }

   
  
 
 public ActionForward Retirer(ActionMapping mapping, ActionForm form,
    HttpServletRequest request, HttpServletResponse response) throws SQLException {
  SortiForm sortiForm = (SortiForm) form;
   List list=null;
   ArrayList nouv= new ArrayList();
   
   list = sortiForm.getListajouter();
   String art = request.getParameter("aaa");
   System.out.println("arti"+art);
   String prof = request.getParameter("ppp");
   System.out.println("prof"+prof);
   String ser_str = request.getParameter("st");
   System.out.println("serial_str"+ser_str);
   String ser_end = request.getParameter("see");
   System.out.println("serial_end"+ser_end);
   String quante = request.getParameter("qt");
   System.out.println("qte"+quante);
   
   System.out.println("colle"+list.size());
   for (int i=0; i<list.size();i++){
   
   Rang3 list2= (Rang3)list.get(i); 
   System.out.println("dans le for");
   
   Rang3 pre = new Rang3();
  
   System.out.println(i);
   System.out.println("soum"+list2.getAa());
   
   if ((list2.getAa().equals(art))&&(list2.getProff().equals(prof))&&(list2.getEndd().equals(ser_end))&&(list2.getStt().equals(ser_str))) 
   {
    System.out.println("dans le if");
   }
   else{
    nouv.add(list2);
    System.out.println("dans le else");
   }
   
   }
   
   sortiForm.setListajouter(nouv);
   
   
   sortiForm.setHiddenTest("");
   return mapping.findForward("auto"); 
   }

  
 public String getResult(String Str)
 {
  return ((Str != null) ? Str=Str.trim():Str); 
 }
  
  
  public String setResult(String Str)
  {
   return ((Str != null) ? Str : null); 
  }
  
  
  
  
  public ActionForward valider(ActionMapping mapping, ActionForm form,
    HttpServletRequest request, HttpServletResponse response) throws SQLException,IOException, ServletException, ParseException  {
   SortiForm sortiForm = (SortiForm) form;
  
      Connexion connexion=new Connexion();
      Connection con=connexion.createConnection();
      
      
      String idpart = null,idact=null,idart,idprof,maxrng=null,res1=null,res2,start,end,tra,wh,
      no,whp,pfp,arp,rp,acp,pq,statu,swap,promo,prior,p,t,s,r,sta2=null,end2,res3=null;
      Statement st,st1,st2,st3,st4,st5,st6,st7,st8,st9,st10,st11,st12 = null;
      ResultSet rs,rs1,rs2,rs3,rs4,rs5,rs6,rs8 = null;
      int h,h1,h2,h3,h4,h5,h6,h7,h8;
      Integer I2;
      Number P=0;
      long R2=0,R3=0,I=0,Res2=0,I1=0;
      List listt;
      String whh=null,codedist=null;
      ArrayList priv =  new ArrayList() ;
      
      
      st=con.createStatement();
      st1=con.createStatement();
      st2=con.createStatement();
      st3=con.createStatement();
      st4=con.createStatement();
      st5=con.createStatement();
      st6=con.createStatement();
      st7=con.createStatement();
      st8=con.createStatement();
      st9=con.createStatement();
      st10=con.createStatement();
      st11=con.createStatement();
      st12=con.createStatement();
      
      String max= (String)request.getSession().getAttribute("maxtrans");
      System.out.println(max);
      
      String mm= (String)request.getSession().getAttribute("username");
      System.out.println(mm);
      
     /* String whh = (String)request.getSession().getAttribute("werhs");
      System.out.println(whh);*/
      
      
  String mag=sortiForm.getMagasourc();
      System.out.println(mag);
      
      String dist=sortiForm.getDistination();
      System.out.println(dist);
   
      
   /*   String mag=sortiForm.getMag();
    System.out.println(mag);
    
    String dist=sortiForm.getDis();
    System.out.println(dist);*/
      
      
      
      String note=sortiForm.getNote();
      System.out.println(note);
      
      String code=sortiForm.getCodaprob();
      System.out.println(code);
      
      con.setAutoCommit(false);
      
      rs1=st1.executeQuery("select dest_id from gss_destinataire where dest_nom='"+dist+"' and dest_type<>'FOURNISSEUR' and dest_type<>'PARTENAIRE' ");
      
      
      //rs2=st2.executeQuery("select whs_id from gss_warehouse where gss_warehouse.whs_adresse='"+origin+"'");
      
      rs3=st3.executeQuery("select ACT_ID from gss_actor where act_name='"+mm+"'");
      
      
      
      
      while (rs1.next())
         {
                      
          codedist = rs1.getString(1).trim();
         System.out.println(codedist);
          }
      
      /*
      while (rs2.next())
         {
                      
          String whs = rs2.getString(1).trim();
         System.out.println(whs);
          }*/
      
      
      
      while (rs3.next())
         {
                      
          idact = rs3.getString(1).trim();
         System.out.println(idact);
          }
    /*  
    try{
      rs4=st4.executeQuery("select max(rng_id) from gss_range where ACT_ID='"+idact+"'");
      
      if (rs4.next()){
          maxrng=rs4.getString(1).trim();
         System.out.println(maxrng);
         
         R2=Long.parseLong(maxrng);
         R2=R2+1;
      res1=Long.toString(R2);
      System.out.println(res1);
         
         }
      
      
     }
      
       
        catch (Exception e) {
        
        res1 = "1000000000";
        
       }
      */
      
      listt=sortiForm.getListajouter();
      
      
      
       
       
      
        
        
        
       
       
       /*   if (prof!="_"){
          rs6=st6.executeQuery("select profil_id from gss_article_profil where profil_libelle='"+prof+"'");
          
          if (rs6.next()){
             idprof=rs6.getString(1).trim();
            System.out.println(idprof);
            }
          }*/
      
     // h = st.executeUpdate("insert into  gss_transaction values('"+max+"','TRE','W00',SYSDATE,'"+idact+"','"+codesource+"','','"+note+"','','','')");
      
       
      int size=listt.size();
    System.out.println(size);
    
    
       
       if (size==0){
       System.out.println("la collection est vide"); 
       
       sortiForm.setHiddenTest("collection null");
       
         return mapping.findForward("auto1");
        
       }
       else
        
       {
        System.out.println("insert into  gss_transaction values('"+max+"','ASO','W00',SYSDATE,'"+idact+"','"+codedist+"',decode('"+code+"','null',null,'"+code+"'),'"+note+"','','','','','N')");
        h = st.executeUpdate("insert into  gss_transaction values('"+max+"','ASO','W00',SYSDATE,'"+idact+"','"+codedist+"',decode('"+code+"','null',null,'"+code+"'),'"+note+"','','','','','N')");
        
        
        for (int i=0;i<listt.size();i++)
        {
         System.out.println(i);
         Rang3 rn = (Rang3)listt.get(i); 
         System.out.println("aa="+rn.getAa());
                  System.out.println("pp="+rn.getProff());
         System.out.println("st="+rn.getStt());
         System.out.println("se="+rn.getEndd());
         System.out.println("qt="+rn.getQtt());
         
         String art=rn.getAa();
         System.out.println(art);
         
         if (art.equals("")){
          System.out.println("la collection est vide"); 
       
          sortiForm.setHiddenTest("collection null");
        
          return mapping.findForward("auto1");
         
        
         }
         
         try{
       rs4=st4.executeQuery("select max(rng_id) from gss_range where ACT_ID='"+idact+"'");
       
       if (rs4.next()){
           maxrng=rs4.getString(1).trim();
          System.out.println(maxrng);
          
          R2=Long.parseLong(maxrng);
          R2=R2+1;
       res1=Long.toString(R2);
       System.out.println(res1);
          
          }
       
       
      }
       
        
         catch (Exception e) {
         
         res1 = "1000000000";
         
        }
         
         String prof=rn.getProff();
         System.out.println(prof);
         String sta=rn.getStt();
         System.out.println(sta);
         String ind=rn.getEndd();
         System.out.println(ind);
         
         
         rs2=st2.executeQuery("select distinct rng_start,rng_end,rng_id,act_id,profil_id,art_id,rng_pq,rng_statut,rng_swap,trans_type,gss_range.whs_id,trans_no,rng_promotion,rng_priorite,rng_packaged,rng_transfert,rng_sortie,rng_reintegration,rng_whs,rng_dist,rng_packaging_whs,rng_sortie_whs,rng_reintegration_whs,rng_transfert_whs from gss_range,gss_warehouse  where (rng_inactif ='A') and gss_range.rng_tpd is null and gss_range.rng_whs=gss_warehouse.whs_id and gss_warehouse.whs_adresse='"+mag+"' and gss_range.rng_statut= 'CHARGE' and gss_range.rng_sortie='N' or (rng_inactif ='A' and gss_range.rng_tpd is null and gss_range.rng_whs=gss_warehouse.whs_id and gss_warehouse.whs_adresse='"+mag+"' and gss_range.rng_swap='SWAP'and gss_range.rng_sortie='N')  or (rng_inactif ='A' and gss_range.rng_tpd is null and gss_range.rng_whs=gss_warehouse.whs_id and gss_warehouse.whs_adresse='"+mag+"' and gss_range.rng_packaged='P' and gss_range.rng_statut='ACTIVE' and gss_range.rng_sortie='N')");
         
       
         while (rs2.next()){
          System.out.println("dans le while");
          
           
          
          start = rs2.getString(1).trim();
          System.out.println("1"+start);
          
          end = rs2.getString(2).trim();
          System.out.println("2"+end);
          
          rp=rs2.getString(3).trim();
          System.out.println("3"+rp);
          
          acp=rs2.getString(4).trim();
          System.out.println("4"+acp);
          
          pfp=getResult(rs2.getString(5));
            System.out.println("5"+pfp);
          
          
          arp=rs2.getString(6).trim();
          System.out.println("6"+arp);
          
          
         pq=getResult(rs2.getString(7));
            System.out.println("7"+pq);
          
          statu=rs2.getString(8).trim();
           System.out.println("8"+statu);
          
          swap=getResult(rs2.getString(9));
            System.out.println("9"+swap);
          
            
   /*       tra = rs2.getString(10).trim();
          
          wh=rs2.getString(11).trim();
          no=rs2.getString(12).trim();*/
          
          
          promo=getResult(rs2.getString(13));
            System.out.println(promo);
            
         
          
          prior=getResult(rs2.getString(14));
            System.out.println(prior);
          
          p=rs2.getString(15).trim();
          t=rs2.getString(16).trim();
          s=rs2.getString(17).trim();
          r=rs2.getString(18).trim();
          
          whp=rs2.getString(19).trim();
          
          String distt=getResult(rs2.getString(20));
     System.out.println("20"+dist);
     
     
     String whspack=getResult(rs2.getString(21));
           System.out.println("21"+whspack);
          
           String whssor=getResult(rs2.getString(22));
           System.out.println("22"+whssor);
           
           String whsrentegr=getResult(rs2.getString(23));
           System.out.println("23"+whsrentegr);
           
           String whstransfert=getResult(rs2.getString(24));
                  System.out.println("24"+whstransfert);
         
         
         
         
         
         
         
        
        
        
        /*************** rang entier*******************************/
        
        if((sta.equals(start))&&(ind.equals(end)))
        { 
         System.out.println("dans le 1er if");
         
        
         
         h2 = st7.executeUpdate("insert into gss_range values ('"+res1+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+sta+"','"+ind+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'ASO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','O','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),'"+codedist+"',decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
         
         h3 = st9.executeUpdate("insert into gss_transaction_range values ('ASO','W00','"+max+"','"+res1+"','"+idact+"',SYSDATE)");
         
       
         
         
         h3 = st9.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res1+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
         
        
         h8 = st12.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
         
         
        
        break;
        }
        
        else{
         System.out.println("dans le else1");
        }
        
        
        
        
        
        
        
        
        
        /**********  le 1er rang********************/
        
        
        /*Res1=Long.parseLong(sta);
        Res2=Long.parseLong(ind);*/
        
        
        
           
         if((sta.equals(start))&&(Long.parseLong(ind)< Long.parseLong(end)) )
        {
         System.out.println("dans le 2eme if");
         
         I=Long.parseLong(ind);
         I=I+1;
         sta2=Long.toString(I);
         
        
         
               
                        h2 = st7.executeUpdate("insert into gss_range values ('"+res1+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+sta+"','"+ind+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'ASO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','O','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),'"+codedist+"',decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
         
         h3 = st9.executeUpdate("insert into gss_transaction_range values ('ASO','W00','"+max+"','"+res1+"','"+idact+"',SYSDATE)");
         
         
         R3=Long.parseLong(res1);
     R3=R3+1;
     res2=Long.toString(R3);
      System.out.println(res2);
         
         h4 = st10.executeUpdate("insert into gss_range values ('"+res2+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+sta2+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
         
        
         
         
         h3 = st9.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res1+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
         
        
        h1 = st11.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res2+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
         
        
        h8 = st12.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
        break; 
        }
        else 
        {
         System.out.println("dans le else2");
        }
        
        
        
        
        
        
        
         /*****************2er partie***************/
        
      if((Long.parseLong(sta)> Long.parseLong(start))&&(ind.equals(end)) )
        
        
        {
         System.out.println("dans le 3eme if");
         
        
         
                  h2 = st7.executeUpdate("insert into gss_range values ('"+res1+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+sta+"','"+ind+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'ASO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','O','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),'"+codedist+"',decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
         
         
         
         h3 = st9.executeUpdate("insert into gss_transaction_range values ('ASO','W00','"+max+"','"+res1+"','"+idact+"',SYSDATE)");
         
         
         I=Long.parseLong(sta);
         I=I-1;
         end2=Long.toString(I);
         
        
         
         R3=Long.parseLong(res1);
     R3=R3+1;
     res2=Long.toString(R3);
      System.out.println(res2);
      
         h4 = st10.executeUpdate("insert into gss_range values ('"+res2+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+end2+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
        
         
         h3 = st9.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res1+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'"); 
        
         h1 = st11.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res2+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
        
         h8 = st12.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
         
         
        break; 
        }
        else 
        {
         System.out.println("dans le else3");
        }
        
       
        
        
        /* 3 parties*/
         if((Long.parseLong(sta)> Long.parseLong(start))&&(Long.parseLong(ind)< Long.parseLong(end)))
           
        
        {
         System.out.println("dans le 4eme if");
         
        
                   h2 = st7.executeUpdate("insert into gss_range values ('"+res1+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+sta+"','"+ind+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'ASO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','O','"+r+",'"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),'"+codedist+"',decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
         
         
         
         h3 = st9.executeUpdate("insert into gss_transaction_range values ('ASO','W00','"+max+"','"+res1+"','"+idact+"',SYSDATE)");
         
         
         I=Long.parseLong(sta);
         I=I-1;
         end2=Long.toString(I);
         
         I1=Long.parseLong(ind);
         I1=I1+1;
         sta2=Long.toString(I1);
         
         
         R3=Long.parseLong(res1);
     R3=R3+1;
     res2=Long.toString(R3);
      System.out.println(res2);
         
         h4 = st10.executeUpdate("insert into gss_range values ('"+res2+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+end2+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
         
      
     R3=R3+1;
     res3=Long.toString(R3);
      System.out.println(res3);
         
          h5 = st7.executeUpdate("insert into gss_range values ('"+res3+"','"+idact+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+sta2+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
          
         
          
          
          h3 = st9.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res1+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'"); 
         
          h1 = st11.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res2+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
          
          h7 = st6.executeUpdate("insert into gss_transaction_range select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+res3+" ,'"+idact+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
          
          h8 = st12.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
         
         break;
         
         
        }
        else 
        {
         System.out.println("dans le 4 else");
        }
        
         }
         }
       
    
      }
      
       con.commit();
   
   
    
    
    ActionForward  forward = new RedirectingActionForward();
         forward.setPath("/autosorti.do?hidden=afficher");
         return forward; 
 }
  
  
  public ActionForward annuler(ActionMapping mapping, ActionForm form,
    HttpServletRequest request, HttpServletResponse response)throws IOException, ServletException, SQLException  {
   
   SortiForm sortiForm = (SortiForm) form;
   
 ActionForward  forward = new RedirectingActionForward();
        forward.setPath("/autosorti.do?hidden=afficher");
        return forward;
        }
 
   
  /* String res=sortiForm.getReserv();
   System.out.println(res);
   return null;*/
  
  }

