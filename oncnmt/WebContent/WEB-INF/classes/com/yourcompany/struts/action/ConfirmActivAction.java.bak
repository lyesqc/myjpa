/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.yourcompany.struts.action;

import java.io.IOException;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.action.RedirectingActionForward;
import org.apache.struts.actions.DispatchAction;

import com.yourcompany.struts.form.ConfirmActivForm;
import  com.yourcompany.struts.UtilClass.Connexion;
import com.yourcompany.struts.UtilBean.ActivPost;
import  com.yourcompany.struts.UtilBean.Confirmation;
import com.yourcompany.struts.UtilBean.Preactive;


public class ConfirmActivAction extends DispatchAction {
	
	public ActionForward ouvrir(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)throws IOException, ServletException, SQLException  {
		
		ConfirmActivForm confirmActivForm = (ConfirmActivForm) form;
		
		
		Connexion connexion=new Connexion();
		Connection con=connexion.createConnection();
		Statement st,st1,st2,st3,st4,st5 = null;
		ResultSet rs,rs1,rs2,rs3,rs4,rs5 = null;
		ArrayList nomProfil= new ArrayList() ;
		ArrayList nomArticle= new ArrayList() ;
		String art,prof,trans,type,wh=null;
		ArrayList list = new ArrayList();
		ArrayList list1 = new ArrayList();
		
		String dest = request.getParameter("dest");
		System.out.println("dest "+dest);
		
		request.getSession().setAttribute("des", dest);
		
		String max=null; String maxi =null;
		String whs = (String)request.getSession().getAttribute("werhs");
		System.out.println("le whs"+whs);
		
		st=con.createStatement();
		st1=con.createStatement();
		st2=con.createStatement();
		st3=con.createStatement();
		st4=con.createStatement();
		
		System.out.println("dans le ouvrir");
		String no = request.getParameter("no");
		System.out.println(no);
		
		type = no.substring(0,3);
		System.out.println(type);
		wh = no.substring(4,7);
		System.out.println(wh);
		trans = no.substring(8,13);
		System.out.println(trans);
		
		
	
		
		rs=st.executeQuery("SELECT profil_libelle FROM GSS_ARTICLE_PROFIL");
		rs1=st1.executeQuery("select art_art_libelle from gss_article where art_type_id = 'S1'");
		//rs2=st2.executeQuery("select max(trans_no) from gss_transaction where (trans_type='CPO') and (whs_id='"+whs+"')");
		//rs3=st3.executeQuery("select distinct art_art_libelle,profil_libelle,rng_start,rng_end,case when a.art_type_id in ('S1','S2') then decode(substr(r.rng_start, 4, 1),'0', substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2', substr(r.rng_start, 4, 2), '0' || substr(r.rng_start, 5, 1)) else '_' end hlr,case when a.art_type_id in ('S1','S2') then decode(r.rng_packaged, 'O', 'Sous ordre', 'C', 'En Cours', 'P', 'Package', 'N', 'Non Package') else  '_' end PACKAGING,rng_statut,(rng_end-rng_start+1) as qte from gss_range r,gss_article a,gss_article_profil p,gss_article_type t where (a.art_id=r.art_id)and (p.profil_id=r.profil_id )and (a.art_type_id=t.art_type_id)and(t.art_type_libelle='SIMPOST')and(r.rng_inactif='A')and(r.rng_statut='BRUTE')and(p.profil_libelle in ('BUSINESS','DJEZZY CLASSIC','DJEZZY CONTROL','BUSINESS CONTROL')) order by qte");
		rs4=st4.executeQuery("select distinct art_art_libelle,profil_libelle,rng_start,rng_end,case when a.art_type_id in ('S1','S2')then decode(substr(r.rng_start, 4, 1),'0',substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2',substr(r.rng_start, 4, 2), '0' || substr(r.rng_start, 5, 1)) else '_' end hlr,case when a.art_type_id in ('S1','S2')then decode(r.rng_packaged, 'O', 'Sous ordre', 'C', 'En Cours', 'P', 'Package', 'N', 'Non Package')else  '_' end PACKAGING, rng_statut,(rng_end-rng_start+1) as qte from gss_range r,gss_article a,gss_article_profil p,gss_transaction_range tr, gss_transaction t where (a.art_id=r.art_id) and (p.profil_id=r.profil_id )and (tr.t_r_rng_id=r.rng_id) and (tr.t_r_rng_act_id=r.act_id) and (tr.t_r_trans_type='"+type+"') and (tr.t_r_trans_no='"+trans+"') and (tr.t_r_trans_whs='"+wh+"') and(r.rng_inactif='A')and (r.rng_statut='EN COURS') order by qte");
		System.out.println("select distinct art_art_libelle,profil_libelle,rng_start,rng_end,case when a.art_type_id in ('S1','S2')then decode(substr(r.rng_start, 4, 1),'0',substr(r.rng_start, 4, 2),'1', substr(r.rng_start, 4, 2),'2',substr(r.rng_start, 4, 2), '0' || substr(r.rng_start, 5, 1)) else '_' end hlr,case when a.art_type_id in ('S1','S2')then decode(r.rng_packaged, 'O', 'Sous ordre', 'C', 'En Cours', 'P', 'Package', 'N', 'Non Package')else  '_' end PACKAGING, rng_statut,(rng_end-rng_start+1) as qte from gss_range r,gss_article a,gss_article_profil p,gss_transaction_range tr, gss_transaction t where (a.art_id=r.art_id) and (p.profil_id=r.profil_id )and (tr.t_r_rng_id=r.rng_id) and (tr.t_r_rng_act_id=r.act_id) and (tr.t_r_trans_type='"+type+"') and (tr.t_r_trans_no='"+trans+"') and (tr.t_r_trans_whs='"+wh+"') and(r.rng_inactif='A')and (r.rng_statut='EN COURS') order by qte");
		
		while (rs.next())
		{
			prof = rs.getString(1).trim();
			nomProfil.add(prof);
			System.out.println(prof);
		}
		
		while (rs1.next())
		{
			art = rs1.getString(1).trim();
			nomArticle.add(art);
			System.out.println(art);
		}
		
		
		
		try{
			
			rs2=st2.executeQuery("select max(trans_no) from gss_transaction where (trans_type='CPO') and (whs_id='"+whs+"')");
			if (rs2.next()){
				max = rs2.getString(1).trim();
				System.out.println("le max :"+max);
			}
			int res =Integer.parseInt(max);
			int res1=res+1;
			maxi = Integer.toString(res1);
			}
			catch (Exception e){
				maxi = "10000";
	     		//System.out.println("rs est null");	
	     	}
			
			request.getSession().setAttribute("max", maxi);
			
			String code_trans = "CPO"+"-"+whs+"-"+maxi;
			System.out.println("le code :"+code_trans);
			
			
			
		while (rs4.next()){
			
			Confirmation confirmer = new Confirmation();
			
			confirmer.setArticle(rs4.getString(1).trim());
			confirmer.setProfil(rs4.getString(2).trim());
			System.out.println(rs4.getString(2).trim());	
			
			confirmer.setStart(rs4.getString(3).trim());
			confirmer.setEnd(rs4.getString(4).trim());
			confirmer.setHlr(rs4.getString(5).trim());
			confirmer.setPack(rs4.getString(6).trim());
			confirmer.setActiv(rs4.getString(7).trim());
			confirmer.setQute(rs4.getString(8).trim());
			confirmer.setArt1(rs4.getString(1).trim());
			confirmer.setProf1(rs4.getString(2).trim());
			confirmer.setQt1(rs4.getString(8).trim());
			confirmer.setS_str1(rs4.getString(3).trim());
			confirmer.setS_end1(rs4.getString(4).trim());
			
			list.add(confirmer);
			System.out.println("["+rs4.getString(1)+"],["+rs4.getString(2)+"],["+rs4.getString(3)+"],["+rs4.getString(4)+"],["+rs4.getString(5)+"]"+"],["+rs4.getString(6)+"]"+"],["+rs4.getString(7)+"]"+"],["+rs4.getString(8)+"]");
			
		}
		
		Confirmation confirmer = new Confirmation();
		
		confirmer.setAa("");
		confirmer.setPp("");
		confirmer.setQt("");
		confirmer.setSe("");
		confirmer.setSt("");
		list1.add(confirmer);
		
		System.out.println("apres la 2eme coll");
		
		
		confirmActivForm.setActivation(list);
		confirmActivForm.setActivation2(list1);
		confirmActivForm.setNomArticle(nomArticle);
		confirmActivForm.setNomProfil(nomProfil);
		confirmActivForm.setTrans(code_trans);
		confirmActivForm.setArticle("");
		confirmActivForm.setProfil("");
		confirmActivForm.setND(null);
		confirmActivForm.setNF(null);
		confirmActivForm.setHiddenTest("");
		
		
		System.out.println("apres le form");
		
		
		
		return mapping.findForward("CPO"); 
		
	}
	
	public ActionForward afficher(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)throws IOException, ServletException, SQLException  {
		
		ConfirmActivForm confirmActivForm = (ConfirmActivForm) form;
		
		ArrayList list = new ArrayList();
		List list2,list3;
		
		list2 = confirmActivForm.getActivation();
		list3 = confirmActivForm.getActivation2();
		
		confirmActivForm.setActivation(list2);
		//art1,prof1,s_str1,s_end1,qt1
		String article = request.getParameter("art1");
		System.out.println(article);
		
		String profil = request.getParameter("prof1");
		System.out.println("parametre profil ="+profil);
		
		String s_str = request.getParameter("s_str1");
		Long s_str1 =Long.parseLong(s_str);
		System.out.println(s_str);
		
		String s_end = request.getParameter("s_end1");
		Long s_end1 =Long.parseLong(s_end);
		System.out.println(s_end);
		
		String qute = request.getParameter("qt1");
		System.out.println(qute);
		
   //	 dans les combos
		confirmActivForm.setArticle(article);
		confirmActivForm.setProfil(profil);
		confirmActivForm.setND(s_str1);
		confirmActivForm.setNF(s_end1);
		
		confirmActivForm.setNot(confirmActivForm.getNot());
		confirmActivForm.setHiddenTest("");
		
		
		return mapping.findForward("CPO"); 
	}
	
	public String getResult(String Str)
	{
		return ((Str != null) ? Str=Str.trim():Str);	
	}
	
	
	public String setResult(String Str)
	{
		return ((Str != null) ? Str : null);	
	}
	
	
	public ActionForward Ajouter(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)throws IOException, ServletException, SQLException  {
		
		ConfirmActivForm confirmActivForm = (ConfirmActivForm) form;
		
		String art,prof,nd,nf,qute=null;
		Long ndl,nfl,qte;
		List list=null;
		List listGrand=null;
		Boolean trouver= false;
		 Boolean boucle= false, existe= false, existe2=false;
		ArrayList nouv=new ArrayList();
		
		list = confirmActivForm.getActivation2();
		listGrand = confirmActivForm.getActivation();
		
		art = confirmActivForm.getArticle();
		
		prof = confirmActivForm.getProfil();
		
		 Long serial_start = confirmActivForm.getND();
		 Long serial_end = confirmActivForm.getNF();
		 
		 nd = Long.toString(serial_start);
		 System.out.println(nd);
		 nf = Long.toString(serial_end);
		
		 System.out.println(nf);
		
		ndl=Long.parseLong(nd);
		nfl=Long.parseLong(nf);
		qte=nfl-ndl+1;
		qute=Long.toString(qte);
		
		if (qte<=0){
			confirmActivForm.setHiddenTest("fin inferieur debut");	
	    	 System.out.println("le fin est< debut");
	    	 
	    	 confirmActivForm.setArticle("");
	    	 confirmActivForm.setProfil("");
	    	 confirmActivForm.setND(null);
	    	 confirmActivForm.setNF(null);
	    	
	    	  return mapping.findForward("CPO");
	     }
		
		
		Confirmation confirmer = new Confirmation();
		
           ///////////// vérifier la taille du serial number
		
		if(nd.length()<12 )
		 {
			confirmActivForm.setHiddenTest("serial début insuffisant");	
		   	    System.out.println("serial début insuffisant");
		   	    boucle = true;
		   	    return mapping.findForward("CPO");
		 }
		 else {
			 if(nf.length()<12){
				 
				 confirmActivForm.setHiddenTest("serial fin insuffisant");	
			   	    System.out.println("serial fin insuffisant");
			   	    boucle = true;
			   	    return mapping.findForward("CPO");
				 
			 }
		 }
		
       if(boucle.equals(false))
			
		{
    	 
   	  if (list.size()==0){
		
   		 for (int j=0;j<listGrand.size();j++){
   			Confirmation list3 = (Confirmation)listGrand.get(j);
   		 if(
 	    	     (ndl >= Long.parseLong(list3.getStart()) 
 	    	    		 &&  
 	    	      nfl<= Long.parseLong(list3.getEnd())
 	    	             &&
 	    	      prof.equals(list3.getProfil()))
 	    	    )
 	    		{
 	    		
 	    		 trouver=true;
 	    		 existe=true;
 	    		 
 	    		 break;
 	    		
 	    		 	
 	    		}/// end if teste coll grande
   		 }//// end for coll grande
   		
   		 if (existe.equals(false)){
   			confirmActivForm.setHiddenTest("range n'est pas dans la coll grande");	
	    	 System.out.println("range n'existe pas dans la collection grande");
	    	 
	    	
	    	
	    	  return mapping.findForward("CPO");
	     }
   		else{
   			
   		 //	  calculer la quantité
	  		
	  		 qte=nfl-ndl+1;
	  		 qute=Long.toString(qte);
	  		 System.out.println(qute);
	  		 
	  		 // remplir la collection
	  		 
	  		
	  		confirmer.setAa(art);
			confirmer.setPp(prof);
			confirmer.setQt(qute);
			confirmer.setSe(nf);
			confirmer.setSt(nd);
			//les paramId
			confirmer.setAaa(art);
			confirmer.setPpp(prof);
			confirmer.setQtt(qute);
			confirmer.setStt(nd);
			confirmer.setSee(nf);
	  		
			list.add(confirmer);

			 for (int j=0; j<list.size();j++){
	  				System.out.println("dans le for");
	  				System.out.println("j ="+j);
	  				
	  				Confirmation list3 = (Confirmation)list.get(j);
	  					
	  				  if ((list3.getAa().equals("")))  
	  					{
	  						System.out.println("dans le if");
	  					}
	  			      else{
	  						nouv.add(list3);
	  						System.out.println("dans le else");
	  					
	  					}
	  					
	  			      }
			    trouver=true;
			    confirmActivForm.setActivation2(nouv);
 		    	
 		   
 		    }// end if ""

   		}///
   	  
   	  else{
   		 
		 for (int i=0; i<list.size();i++){
			 Confirmation list2 = (Confirmation)list.get(i);
				
				if (list2.getAa().equals("")){
	  		    	
	  		    	System.out.println("la 1ere ligne vide");
	  		    	
	  		    	for (int j=0;j<listGrand.size();j++){
	  		    		Confirmation list3 =(Confirmation) listGrand.get(j);
	  		    		
	  		    		
	  		    	 if(
	  		    			(ndl >= Long.parseLong(list3.getStart()) 
	  			    	    		 &&  
	  			    	      nfl<= Long.parseLong(list3.getEnd())
	  			    	             &&
	  			    	      prof.equals(list3.getProfil())) 
	  		    	     )
	  		    		{
	  		    		 
	  		    		 
	  		    		
	  		    		 trouver=true;
	  		    		 existe=true;
	  		    		 
	  		    		 break;
	  		    		
	  		    		 	
	  		    		}/// end if teste coll grande
	  		    	 
	  		    	 
	  		    	
	  		    		    
	  		    	  }//// end for coll grande
	  		    	
	  		    	if (existe.equals(false)){
	  		    		 confirmActivForm.setHiddenTest("range n'est pas dans la coll grande");	
		  		    	 System.out.println("range n'existe pas dans la collection grande");
		  		    	
		  		    	
		  		    	  return mapping.findForward("CPO");
		  		     }
	  		    	
	  		    	else{
	  		    	
                  //	  calculer la quantité
			  		
			  		 qte=nfl-ndl+1;
			  		 qute=Long.toString(qte);
			  		 System.out.println(qute);
			  		 
			  		 // remplir la collection
			  		 
			  		
			  		confirmer.setAa(art);
					confirmer.setPp(prof);
					confirmer.setQt(qute);
					confirmer.setSe(nf);
					confirmer.setSt(nd);
					//les paramId
					confirmer.setAaa(art);
					confirmer.setPpp(prof);
					confirmer.setQtt(qute);
					confirmer.setStt(nd);
					confirmer.setSee(nf);
			  		
					list.add(confirmer);
		
					 for (int j=0; j<list.size();j++){
			  				System.out.println("dans le for");
			  				System.out.println("j ="+j);
			  				
			  				Confirmation list3 = (Confirmation)list.get(j);
			  					
			  				  if ((list3.getAa().equals("")))  
			  					{
			  						System.out.println("dans le if");
			  					}
			  			      else{
			  						nouv.add(list3);
			  						System.out.println("dans le else");
			  					
			  					}
			  					
			  			      }
					    trouver=true;
					    confirmActivForm.setActivation2(nouv);
					    confirmActivForm.setHiddenTest("");
		  		    	break;
		  		   
		  		    }// end if ""
				}
			  		
				 ///// si la collection est non vide
	  		    
		  		 else{
		  		    	
		  		    	System.out.println("la 1ere ligne non vide");
		  		         
		  		    	
		  		    	if(
			  		    			(Long.parseLong(nd)>= Long.parseLong(list2.getSt()) )&& (Long.parseLong(nf)<= (Long.parseLong(list2.getSe()) ))
			  		    			||
			  		    			(Long.parseLong(list2.getSt())>=Long.parseLong(nd) && Long.parseLong(list2.getSt())<=Long.parseLong(nf))
			  		    			||
			  		    			(Long.parseLong(list2.getSe())>=Long.parseLong(nd) && Long.parseLong(list2.getSe())<=Long.parseLong(nf))
			  		    	
			  		    	   )
		  		    	{
		  		    		confirmActivForm.setHiddenTest("range dans la coll");	
			  		    	 System.out.println("range existe dans la collection");
			  		    	 trouver=true;
			  		    	 existe2= true;
			  		    	 existe=true;
			  		    	 
			  		    	return mapping.findForward("CPO");
		  		    	}//// end if collection
		  		    
		  		    }/// end else " "
				
				if(existe2.equals(false))
		    		{
		    		//// n'existe pas dans la petite coll
					for (int j=0;j<listGrand.size();j++){
						Confirmation list3 =(Confirmation) listGrand.get(j);
	  		    		
	  		    		
	  		    		
	  		    		if(
		  		    			(ndl >= Long.parseLong(list3.getStart()) 
		  			    	    		 &&  
		  			    	      nfl<= Long.parseLong(list3.getEnd())
		  			    	             &&
		  			    	      prof.equals(list3.getProfil())) 
		  		    	     )
	  		    		
		  		    		{
		  		    		// trouver=true;
		  		    		 existe=true;
		  		    		 
		  		    		 break;
		  		    		
		  		    		 	
		  		    		}/// end if teste coll grande
	  		    	 	
	  		    	  }//// end for coll grande
		   
		      }// end if existe2
		    
		    }/// end else " "

}
}
       if (existe.equals(false)){
    	   confirmActivForm.setHiddenTest("range n'est pas dans la coll grande");	
      	 System.out.println("range n'existe pas dans la collection grande");
      	 
      	confirmActivForm.setArticle("");
      	confirmActivForm.setProfil("");
      	confirmActivForm.setND(null);
      	confirmActivForm.setNF(null);
      	
      	  return mapping.findForward("CPO");
       }
		 
		 if (trouver.equals(false)){
			 confirmActivForm.setHiddenTest("");
			   
  			 System.out.println("rang n'existe pas dans la collection ");
  			 
  			 //	  calculer la quantité
		  		
	  		 qte=nfl-ndl+1;
	  		 qute=Long.toString(qte);
	  		 System.out.println(qute);
	  		 
	  		 // remplir la collection
	  		 
	  		
	  		confirmer.setAa(art);
			confirmer.setPp(prof);
			confirmer.setQt(qute);
			confirmer.setSe(nf);
			confirmer.setSt(nd);
			//les paramId
			confirmer.setAaa(art);
			confirmer.setPpp(prof);
			confirmer.setQtt(qute);
			confirmer.setStt(nd);
			confirmer.setSee(nf);
	  		
			list.add(confirmer);
	  		
	  		 
	  		
	  		confirmActivForm.setActivation2(list); 
	  }
		
		 /////// vider les combo + champs de texte
		confirmActivForm.setArticle("");
		confirmActivForm.setProfil("");
		confirmActivForm.setND(null);
		confirmActivForm.setNF(null);
		confirmActivForm.setHiddenTest("");
		confirmActivForm.setNot(confirmActivForm.getNot());
		
		
		
		return mapping.findForward("CPO"); 
	}
	
	
	public ActionForward Retirer(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)throws IOException, ServletException, SQLException  {
		
		ConfirmActivForm confirmActivForm = (ConfirmActivForm) form;
		
		List list=null;
		ArrayList nouv= new ArrayList();
		
		list = confirmActivForm.getActivation2();
	
		String art = request.getParameter("aaa");
		System.out.println("arti"+art);
		String prof = request.getParameter("ppp");
		System.out.println("prof"+prof);
		String ser_str = request.getParameter("stt");
		System.out.println("serial_str"+ser_str);
		String ser_end = request.getParameter("see");
		System.out.println("serial_end"+ser_end);
		String quante = request.getParameter("qtt");
		System.out.println("qte"+quante);
		
		for (int i=0; i<list.size();i++){
			Confirmation list2 = (Confirmation)list.get(i);
			
			Confirmation conf = new Confirmation();
			
			if ((list2.getAa().equals(art))&&(list2.getPp().equals(prof))&&(list2.getSe().equals(ser_end))&&(list2.getSt().equals(ser_str))) 
			{
				System.out.println("dans le if");
			}
			else{
				nouv.add(list2);
				System.out.println("dans le else");
			}
			
			}
		confirmActivForm.setActivation2(nouv);
		confirmActivForm.setNot(confirmActivForm.getNot());
		confirmActivForm.setHiddenTest("");
			
		
		
		return mapping.findForward("CPO"); 
	}
	
	public ActionForward valider(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)throws IOException, ServletException, SQLException  {
		
		ConfirmActivForm confirmActivForm = (ConfirmActivForm) form;
		Connexion connexion=new Connexion();
		Connection con=connexion.createConnection();
		
		Statement st,st1,st2,st3,st4,st5,st8,st9,st10,st11,st12 = null;
		ResultSet rs,rs1,rs2,rs3,rs4,rs8,rs12 = null;
		String act_id = null,dest_id=null;
		List activation2;
		String start = null,end = null,tra = null,wh = null,no = null,whp = null,pfp = null,arp = null,rp = null,acp = null,pq = null,statu = null,swap = null,promo=null;
		String prior = null,p = null,t = null,s = null,r = null,ss,ee,maxrng = null,a,b,c,d = null,max_range,max_range2,max_range3=null,rng_end,rng_start;
		int h,h1,h3,R2,R3,R1,h4,h5,R4=0;
		Long l1,l2,l3,l4;
		String nomdest=null;
		
		String user = (String)request.getSession().getAttribute("username");
		System.out.println("user connecté :"+user);
		//String whs = (String)request.getSession().getAttribute("werhs");
		String max = (String)request.getSession().getAttribute("max");
		//System.out.println("warehouse :"+whs);
		System.out.println("le max apres request :"+max);
		String note = confirmActivForm.getNot();
		System.out.println("note "+note);
		String dest = (String)request.getSession().getAttribute("des");
		System.out.println("dest "+dest);
		
		
		
		activation2 = confirmActivForm.getActivation2();
		
		con.setAutoCommit(false);
		
		st = con.createStatement();
		st1=con.createStatement();
		st2=con.createStatement();
		st3=con.createStatement();
		st4=con.createStatement();
		st5=con.createStatement();
		st8=con.createStatement();
		st9=con.createStatement();
		st10=con.createStatement();
		st11 = con.createStatement();
		st12 = con.createStatement();
		
		rs12 = st12.executeQuery("select  d.dest_nom from gss_destinataire d where d.dest_id='"+dest+"' and d.dest_type<>'FOURNISSEUR' and d.dest_type<>'PARTENAIRE'");

		if(rs12.next())
		{
			nomdest =rs12.getString(1).trim();
			System.out.println(nomdest);
		}
		
		rs = st.executeQuery("select act_id from gss_actor where act_name = '"+user+"'");
		//rs2=st2.executeQuery("");
		if(rs.next())
		{
			act_id =rs.getString(1).trim();
			System.out.println(act_id);
		}
		
		
		
		
			
    // insérer les ranges de la 2eme collections dans la base
			
			
			
	//INSERTION DE LA TRANSACTION CPO
		
		if(dest.equals("_")){
			
			System.out.println ("insert into  gss_transaction values('"+max+"','CPO','W00',SYSDATE,'"+act_id+"','','',decode('"+note+"','null',null,'"+note+"'),'','','','','N')");
	        h = st3.executeUpdate("insert into  gss_transaction values('"+max+"','CPO','W00',SYSDATE,'"+act_id+"','','',decode('"+note+"','null',null,'"+note+"'),'','','','','N')");
	        
		}
		else{
			
			System.out.println ("insert into  gss_transaction values('"+max+"','CPO','W00',SYSDATE,'"+act_id+"','"+dest+"','',decode('"+note+"','null',null,'"+note+"'),'','','','','N')");
	        h = st3.executeUpdate("insert into  gss_transaction values('"+max+"','CPO','W00',SYSDATE,'"+act_id+"','"+dest+"','',decode('"+note+"','null',null,'"+note+"'),'','','','','N')");
	         
		}
		
		 ////tester si la collection est vide
		     if(activation2.size()==0){
		    	 
		    	 confirmActivForm.setHiddenTest("collection null");
        		 confirmActivForm.setND(null);
        		 confirmActivForm.setNF(null);
		 		  
		 		  return mapping.findForward("CPO");
		    	 
		     }
	         for (int i=0; i<activation2.size();i++){
	        	 
	        	 System.out.println("i ="+i);
	        	 Confirmation conf = (Confirmation)activation2.get(i); 
	        	 
	        	 String art=conf.getAa();
	        	 
	        	 if (art.equals("")){
			 		  
	        		 confirmActivForm.setHiddenTest("collection null");
	        		 confirmActivForm.setND(null);
	        		 confirmActivForm.setNF(null);
			 		  
			 		  return mapping.findForward("CPO");
			 	   
			 	   } //// end if collection null
	        	 
	        	  else {
			 		   
			 		   
	                  ////// CALCULER le max du range
	   		 			try{
	        	 
	        	     rs4=st5.executeQuery("select max(rng_id) from gss_range where ACT_ID='"+act_id+"'");
	     		     if (rs4.next()){
	     		     
	     		    	maxrng=rs4.getString(1).trim();
	     		      // System.out.println("max range integer:"+maxrng);
	     		       }
	     		
	     		    R2=Integer.parseInt(maxrng);
	     		 
	     		    R2=R2+1;
	     			max_range=Integer.toString(R2);
	     			System.out.println("max range a inséré :"+max_range);  
	   		 			}
	   		 			
	   		 		catch(Exception ex){
	 					max_range = "1000000000";
	 				}
	        	 
	        	// la i eme ligne  
	        	 
	        	 System.out.println("aa="+conf.getAa());
	             System.out.println("pp="+conf.getPp());
	 			 System.out.println("st="+conf.getSt());
	 			 System.out.println("se="+conf.getSe());
	 			 System.out.println("qt="+conf.getQt());
	 		
	 			 ss = conf.getSt();
	 			 System.out.println("ss: "+ss);
	 			 ee = conf.getSe();
	 			 System.out.println("ee: "+ee);
	 			 
           ///////  sélectionner les ranges qui existent dans la base avec l'état EN COURS	
	 			
	 			rs1=st1.executeQuery("select distinct r.rng_start, r.rng_end, r.rng_id, r.act_id, r.profil_id, r.art_id, r.rng_pq, r.rng_statut, r.rng_swap, r.trans_type, r.whs_id, r.trans_no,r.rng_promotion,r.rng_priorite ,r.rng_packaged,r.rng_transfert,r.rng_sortie,r.rng_reintegration,r.rng_whs,r.rng_dist,rng_packaging_whs,rng_sortie_whs,rng_reintegration_whs,rng_transfert_whs from gss_range r,gss_transaction_range tr  where (tr.t_r_rng_id=r.rng_id)  and (tr.t_r_rng_act_id=r.act_id) and (r.rng_statut='EN COURS') and (r.rng_tpd is null)");	 			
	 			while (rs1.next()){
	 				
	 				System.out.println("dans le while");
	 				
	 				start = rs1.getString(1).trim();
	 				System.out.println("1"+start);
	 							
	 				end = rs1.getString(2).trim();
	 				System.out.println("2"+end);
	 			/*	tra = rs1.getString(10).trim();
	 				System.out.println("3"+tra);
	 				wh=rs1.getString(11).trim();
	 				System.out.println("4"+wh);
	 				no=rs1.getString(12).trim();
	 				System.out.println("5"+no);*/
	 				whp=rs1.getString(19).trim();
	 				System.out.println("6"+whp);
	 				pfp=getResult(rs1.getString(5));
	 				System.out.println("7"+pfp);
	 				arp=rs1.getString(6).trim();
	 				System.out.println("8"+arp);
	 				rp=rs1.getString(3).trim();
	 				System.out.println("9"+rp);
	 				acp=rs1.getString(4).trim();
	 				System.out.println("10"+acp);
	 				pq=getResult(rs1.getString(7));
	 				System.out.println("11"+pq);
	 				statu=rs1.getString(8).trim();
	 				System.out.println("12"+statu);
	 				swap=getResult(rs1.getString(9));
	 				System.out.println("13"+swap);
	 				promo=getResult(rs1.getString(13));
	 				System.out.println("14"+promo);
	 			    prior=getResult(rs1.getString(14));
	 				System.out.println("15"+prior);
	 			    p=rs1.getString(15).trim();
	 				System.out.println("16"+p);
	 				t=rs1.getString(16).trim();
	 				System.out.println("17"+t);
	 				s=rs1.getString(17).trim();
	 				System.out.println("18"+s);
	 				r=rs1.getString(18).trim();
	 				System.out.println("19"+r);
	 				
	 				String  dist=getResult(rs1.getString(20));
					
					System.out.println("20"+dist);
					
					
					 String whspack=getResult(rs1.getString(21));
			           System.out.println("21"+whspack);
			          
			           String whssor=getResult(rs1.getString(22));
			           System.out.println("22"+whssor);
			           
			           String whsrentegr=getResult(rs1.getString(23));
			           System.out.println("23"+whsrentegr);
			           
			           String whstransfert=getResult(rs1.getString(24));
			                  System.out.println("24"+whstransfert);
	 			
                    ////	 insertion des ranges dans la base	
	        	
                   ///////	le range fils = range pere
	 			
					if(dest.equals("_")){
	 			  if ( (ss.equals(start)) && (ee.equals(end))) 
				   {
					  System.out.println("dans le 1er if");
					  
					 				  
					    System.out.println("insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','')");	
					    h1 = st4.executeUpdate("insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','',decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
					
											
						System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
						h3 = st9.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"' code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'"); 
					
						h3=0;
						st9=null;
						st9=con.createStatement();
						System.out.println("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range+"','"+act_id+"',SYSDATE)");
						h3 = st9.executeUpdate("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range+"','"+act_id+"',SYSDATE)");
						
						System.out.println("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
						h4=st10.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
					break;
				  }// end if 1
	 			
	 			 
	 			  //////// le range fils est la partie gauche du range pere
				  
				  if((ss.equals(start))&&(Long.parseLong(ee)< Long.parseLong(end))){
					  System.out.println("dans le 2eme if");
					  
					  l1 = Long.parseLong(ee);
					  l2=l1+1;
					  rng_end = Long.toString(l2);
					  
					  
					     System.out.println("la 1ere insertion dans la table range : insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+ss+"','"+ee+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','"+dist+"')");	
						 h1 = st4.executeUpdate("insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+ss+"','"+ee+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','',decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
						 				  
					    R3= Integer.parseInt(max_range);
					    R3 = R3 +1;
						max_range2=Integer.toString(R3);
						 
						
						System.out.println("max range 2 string "+max_range2);  
						
					     System.out.println("la 2eme insertion dans la table range : insert into gss_range values ('"+max_range2+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+rng_end+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','"+dist+"')");	
						 h5 = st11.executeUpdate("insert into gss_range values ('"+max_range2+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+rng_end+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
						 
						 
							
					     System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
					     h3 = st9.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"' code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'"); 
						
					     
						System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range2+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
						h4 = st10.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range2+" ,'"+act_id+"' code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
						
						h3=0;
						st9=null;
						st9=con.createStatement();
						System.out.println("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range+"','"+act_id+"',SYSDATE)");			
						h3 = st9.executeUpdate("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range+"','"+act_id+"',SYSDATE)");
						
						System.out.println("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
						h4=st10.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
					break;
				  }//end if 2
				  
				 
				  ///// le range fils est la partie droite du range pere
				  
				  if((Long.parseLong(ss)> Long.parseLong(start))&&(ee.equals(end)) )
			  
			      {
					  System.out.println("dans le 3eme if");
					  l1 = Long.parseLong(ss);
					  l2=l1-1;
					  rng_start = Long.toString(l2);
					  
					  System.out.println("la 1ere insertion dans la table range : insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+ss+"','"+ee+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','"+dist+"',decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");	
						 h1 = st4.executeUpdate("insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+ss+"','"+ee+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','')");
						 				  
					    R3= Integer.parseInt(max_range);
					    R3 = R3 +1;
						max_range2=Integer.toString(R3);
						 
						
						System.out.println("max range 2 string "+max_range2);  
						
					     System.out.println("la 2eme insertion dans la table range : insert into gss_range values ('"+max_range2+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+rng_start+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','"+dist+"')");	
						 h5 = st11.executeUpdate("insert into gss_range values ('"+max_range2+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+rng_start+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
						 
						 
							
					     System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
					     h3 = st9.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"' code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'"); 
						
					     
						System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range2+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
						h4 = st10.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range2+" ,'"+act_id+"' code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
						
						h3=0;
						st9=null;
						st9=con.createStatement();
						System.out.println("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range+"','"+act_id+"',SYSDATE)");			
						h3 = st9.executeUpdate("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range+"','"+act_id+"',SYSDATE)");
						
						System.out.println("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
						h4=st10.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
					break;
				  
			      }/////// end if 3
				  
				  //////// le fils est au milieu du pere
				
				  if((Long.parseLong(ss)> Long.parseLong(start))&&(Long.parseLong(ee)< Long.parseLong(end)))
				  {
					  System.out.println("dans le 4eme if");
					  
					  l1 = Long.parseLong(ee);
					  l2=l1+1;
					  rng_start = Long.toString(l2);
					  
					  l3= Long.parseLong(ss);
					  l4=l3-1;
					  rng_end = Long.toString(l4);
					  
					  System.out.println("la 1ere insertion dans la table range : insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+rng_end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','"+dist+"')");	
					  h1 = st4.executeUpdate("insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+rng_end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','',decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
					  
					  R3= Integer.parseInt(max_range);
					  R3 = R3 +1;
					  max_range2=Integer.toString(R3);
					  System.out.println("max range 2 string "+max_range2); 
						 
					  System.out.println("la 2eme insertion dans la table range : insert into gss_range values ('"+max_range2+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+rng_start+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','"+dist+"')");	
					  h1 = st4.executeUpdate("insert into gss_range values ('"+max_range2+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+rng_start+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
					  
					  R4= Integer.parseInt(max_range2);
					  R4 = R4 +1;
					  max_range3=Integer.toString(R4);
					  System.out.println("max range 3 string "+max_range3); 
					  
					  System.out.println("la 3eme insertion dans la table range : insert into gss_range values ('"+max_range3+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+ss+"','"+ee+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','"+dist+"')");	
					  h1 = st4.executeUpdate("insert into gss_range values ('"+max_range3+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+ss+"','"+ee+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'),decode('"+whspack+"','null',null,'"+whspack+"'),decode('"+whssor+"','null',null,'"+whssor+"'),decode('"+whsrentegr+"','null',null,'"+whsrentegr+"'),decode('"+whstransfert+"','null',null,'"+whstransfert+"'))");
						 	
					  System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
					  System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range2+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
					  System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range3+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
							
						
					  
					  h3 = st9.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"' code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'"); 
					  h4 = st10.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range2+" ,'"+act_id+"' code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
					  h5 = st8.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range3+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
						
					    
					    h3=0;
						st9=null;
						st9=con.createStatement();
						System.out.println("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range3+"','"+act_id+"',SYSDATE)");			
						
						h3 = st9.executeUpdate("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range3+"','"+act_id+"',SYSDATE)");
						
						System.out.println("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
						h4=st10.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
					
						break;
				  }// end if 4
					}
					
					
					else{
			 			  if ( (ss.equals(start)) && (ee.equals(end))) 
						   {
							  System.out.println("dans le 1er if");
							  
							 				  
							    System.out.println("insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','"+dest+"')");	
							    h1 = st4.executeUpdate("insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','"+nomdest+"')");
							
													
								System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
								h3 = st9.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"' code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'"); 
							
								h3=0;
								st9=null;
								st9=con.createStatement();
								System.out.println("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range+"','"+act_id+"',SYSDATE)");
								h3 = st9.executeUpdate("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range+"','"+act_id+"',SYSDATE)");
								
								System.out.println("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
								h4=st10.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
							break;
						  }// end if 1
			 			
			 			 
			 			  //////// le range fils est la partie gauche du range pere
						  
						  if((ss.equals(start))&&(Long.parseLong(ee)< Long.parseLong(end))){
							  System.out.println("dans le 2eme if");
							  
							  l1 = Long.parseLong(ee);
							  l2=l1+1;
							  rng_end = Long.toString(l2);
							  
							  
							     System.out.println("la 1ere insertion dans la table range : insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+ss+"','"+ee+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"')");	
								 h1 = st4.executeUpdate("insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+ss+"','"+ee+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','"+nomdest+"')");
								 				  
							    R3= Integer.parseInt(max_range);
							    R3 = R3 +1;
								max_range2=Integer.toString(R3);
								 
								
								System.out.println("max range 2 string "+max_range2);  
								
							     System.out.println("la 2eme insertion dans la table range : insert into gss_range values ('"+max_range2+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+rng_end+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"')");	
								 h5 = st11.executeUpdate("insert into gss_range values ('"+max_range2+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+rng_end+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'))");
								 
								 
									
							     System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
							     h3 = st9.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"' code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'"); 
								
							     
								System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range2+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
								h4 = st10.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range2+" ,'"+act_id+"' code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
								
								h3=0;
								st9=null;
								st9=con.createStatement();
								System.out.println("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range+"','"+act_id+"',SYSDATE)");			
								h3 = st9.executeUpdate("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range+"','"+act_id+"',SYSDATE)");
								
								System.out.println("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
								h4=st10.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
							break;
						  }//end if 2
						  
						 
						  ///// le range fils est la partie droite du range pere
						  
						  if((Long.parseLong(ss)> Long.parseLong(start))&&(ee.equals(end)) )
					  
					      {
							  System.out.println("dans le 3eme if");
							  l1 = Long.parseLong(ss);
							  l2=l1-1;
							  rng_start = Long.toString(l2);
							  
							  System.out.println("la 1ere insertion dans la table range : insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+ss+"','"+ee+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"')");	
								 h1 = st4.executeUpdate("insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+ss+"','"+ee+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','"+nomdest+"')");
								 				  
							    R3= Integer.parseInt(max_range);
							    R3 = R3 +1;
								max_range2=Integer.toString(R3);
								 
								
								System.out.println("max range 2 string "+max_range2);  
								
							     System.out.println("la 2eme insertion dans la table range : insert into gss_range values ('"+max_range2+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+rng_start+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"')");	
								 h5 = st11.executeUpdate("insert into gss_range values ('"+max_range2+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+rng_start+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'))");
								 
								 
									
							     System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
							     h3 = st9.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"' code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'"); 
								
							     
								System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range2+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
								h4 = st10.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range2+" ,'"+act_id+"' code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
								
								h3=0;
								st9=null;
								st9=con.createStatement();
								System.out.println("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range+"','"+act_id+"',SYSDATE)");			
								h3 = st9.executeUpdate("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range+"','"+act_id+"',SYSDATE)");
								
								System.out.println("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
								h4=st10.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
							break;
						  
					      }/////// end if 3
						  
						  //////// le fils est au milieu du pere
						
						  if((Long.parseLong(ss)> Long.parseLong(start))&&(Long.parseLong(ee)< Long.parseLong(end)))
						  {
							  System.out.println("dans le 4eme if");
							  
							  l1 = Long.parseLong(ee);
							  l2=l1+1;
							  rng_start = Long.toString(l2);
							  
							  l3= Long.parseLong(ss);
							  l4=l3-1;
							  rng_end = Long.toString(l4);
							  
							  System.out.println("la 1ere insertion dans la table range : insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+rng_end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"')");	
							  h1 = st4.executeUpdate("insert into gss_range values ('"+max_range+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+start+"','"+rng_end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"','"+nomdest+"')");
							  
							  R3= Integer.parseInt(max_range);
							  R3 = R3 +1;
							  max_range2=Integer.toString(R3);
							  System.out.println("max range 2 string "+max_range2); 
								 
							  System.out.println("la 2eme insertion dans la table range : insert into gss_range values ('"+max_range2+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+rng_start+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"')");	
							  h1 = st4.executeUpdate("insert into gss_range values ('"+max_range2+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+rng_start+"','"+end+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'"+statu+"',decode('"+swap+"','null',null,'"+swap+"'),'','','','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'))");
							  
							  R4= Integer.parseInt(max_range2);
							  R4 = R4 +1;
							  max_range3=Integer.toString(R4);
							  System.out.println("max range 3 string "+max_range3); 
							  
							  System.out.println("la 3eme insertion dans la table range : insert into gss_range values ('"+max_range3+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+ss+"','"+ee+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"')");	
							  h1 = st4.executeUpdate("insert into gss_range values ('"+max_range3+"','"+act_id+"',decode('"+pfp+"','null',null,'"+pfp+"'),'"+arp+"','"+ss+"','"+ee+"','"+rp+"','"+acp+"','A',SYSDATE,'',decode('"+pq+"','null',null,'"+pq+"'),'ACTIVE',decode('"+swap+"','null',null,'"+swap+"'),'CPO','W00','"+max+"','','',decode('"+promo+"','null',null,'"+promo+"'),decode('"+prior+"','null',null,'"+prior+"'),'"+p+"','"+t+"','"+s+"','"+r+"','"+whp+"',decode('"+dist+"','null',null,'"+dist+"'))");
								 	
							  System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
							  System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range2+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
							  System.out.println("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range3+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
									
								
							  
							  h3 = st9.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range+" ,'"+act_id+"' code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'"); 
							  h4 = st10.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range2+" ,'"+act_id+"' code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
							  h5 = st8.executeUpdate("insert into gss_transaction_range  select t_r_trans_type, t_r_trans_whs,t_r_trans_no,"+max_range3+" ,'"+act_id+"'code ,t_r_date from gss_transaction_range where t_r_rng_id='"+rp+"' and t_r_rng_act_id ='"+acp+"'");
								
							    
							    h3=0;
								st9=null;
								st9=con.createStatement();
								System.out.println("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range3+"','"+act_id+"',SYSDATE)");			
								
								h3 = st9.executeUpdate("insert into gss_transaction_range values ('CPO','W00','"+max+"','"+max_range3+"','"+act_id+"',SYSDATE)");
								
								System.out.println("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
								h4=st10.executeUpdate("UPDATE gss_range SET rng_inactif = 'I',rng_inactif_date=sysdate WHERE (rng_id='"+rp+"')and (act_id='"+acp+"')");
							
								break;
						  }// end if 4
							}
					
					
	         }// end while
	       } //end else collection null
			
	         }// end for
	         
	         con.commit();
	 		System.out.println("terminer avec sucees");
	 		confirmActivForm.setNot("");
	 		
	 		ActionForward  forward = new RedirectingActionForward();
		      forward.setPath("/preparConfirm.do?");
		      return forward;
	 		
		
		//return null;
	}
	
	public ActionForward annuler(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)throws IOException, ServletException, SQLException  {
		
		ConfirmActivForm confirmActivForm = (ConfirmActivForm) form;
		
		ActionForward  forward = new RedirectingActionForward();
	      forward.setPath("/preparConfirm.do?");
	      return forward;
	      }
}